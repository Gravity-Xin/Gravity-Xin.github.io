---
title: Docker数据卷
date: 2018-11-15 15:15:36
categories: 
- Docker/K8S
tags: 
- Docker
- Volume
comments: true
---

## Volume

* 绕过联合文件系统（UFS）的目录，为一个或多个容器提交访问，方便进行数据共享和持久化操作
* 完全独立于容器的生成周期，删除容器时，不会删除其挂载的数据卷
* 本质上是宿主机上的目录或文件

为容器添加数据卷:

* 使用`docker run -v src:dest:ro`
  * src为宿主机相对路径
  * dest为容器内的绝对路径
  * ro为容器对数据卷的访问权限，表示只读

* 使用Dockerfile中的VOLUME ["/data"]指令创建匿名数据卷
  * /data为容器中的dest目录，而宿主机中的src目录则会在运行该镜像时由docker自动创建
  * 同一个镜像被多次运行时，宿主机的src目录是不同的
  * 这种方式创建的数据卷无法在不同容器中进行数据共享

![volume](/images/docker之数据卷.png)

## Volume容器

创建一个挂载数据卷的容器，其它的容器通过挂载这个容器实现数据共享，那么该容器成为数据卷容器 **当不能访问宿主机目录时，可以通过数据卷容器进行数据共享**

* 使用数据卷容器: `docker run --volumes-from [CONTAINER]`
* 删除容器: `docker rm -v [CONTAINER]`，如果指定了-v选项，则会软删除与该容器关联的数据卷，**但是只有当该数据卷不再被任何容器使用后，数据卷本身才会被真正删除**

![volume contain](/images/docker之数据库卷器.png)

## volume的备份与恢复

* 备份: `docker run --volumes-from [CONTAINER] -v $PWD:/backup ubuntu tar cvf /backup/backup.tar [VOLUME]`
* 还原: `docker run --volumes-from [CONTAINER] -v $PWD:/backup ubuntu tar xvf /backup/backup.atr [VOLUME]`

![volume](/images/docker之数据卷的备份与恢复.png)