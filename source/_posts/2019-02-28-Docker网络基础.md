---
title: Docker网络基础
date: 2019-02-28 11:42:16
categories: 
- Docker/K8S
tags: 
- Docker
- Network
comments: true
---

## Docker提供的网络模式

![img](/images/Docker之网络模式.png)

- Bridge(默认模式): 创建名为`docker0`, IP地址为`172.17.0.1`的虚拟网桥，默认为NAT桥，在iptables中定义了数据转发的规则  **桥接式网络**
  - 该网桥可以当交换机使用，如果网桥还设置了IP地址则还可以当网卡使用
  - 当启动一个容器时，给容器分配IP地址和一对虚拟网卡设备，一端在容器中，一端在桥上(此时网桥当做交换机使用)
  - 同一个宿主机上的多个容器之间，默认是可以互相访问的(都是使用`docker0`作为交换机，且网段相同)
  - 宿主机本身将`docker0`网桥看做IP为`172.17.0.1`的网卡，也可以与容器进行通信
  - 由于容器本身被NAT桥隐藏，因此外部主机(物理机或容器)默认是无法访问宿主机上的容器的
  - 为了让外部主机访问宿主机上的容器，需要使用DNAT方式，即在iptables中添加一个转发规则，当外部主机访问宿主机上的某个端口时该请求被转发到对应容器中  **Docker中的端口映射**

- Container: 多个容器间共享`Network`, `UTS`和`IPC`命名空间，容器间共享网络协议栈和网络虚拟设备  **联盟式网络**
  - 同一个宿主机之间的容器，可以直接通过`localhost`或`127.0.0.1`进行访问

- Host: 容器与宿主机共享`Network`命名空间，网络协议栈和网络设备与宿主机相同，没有独立的IP地址  **开放式网络**

- None: Docker容器中没有网络设备和配置  **封闭式网络**
  - 只有`localhost`网络接口
  - 一般该容器主要是用例进行批处理的任务，不需要与外部进行网络通信

- Overlay

- 自定义网络

## 网络模式的使用

- `docker network ls`: 显示Docker支持的网络

- `docker network inspect`: 查看Docker网络使用的网络模式

- `docker container create|run`命令的`--network`选项: 设置容器使用的网络

- `docker container inspect`: 查看容器使用的网络