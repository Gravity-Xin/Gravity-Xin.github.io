---
title: 一致性哈希
date: 2018-11-28 17:46:28
categories: 
- Algo/DS
tags: 
- Consistent Hash
comments: true
---

## 产生原因

分布式缓存服务中存在多个节点，需要使用一种哈希算法将Key路由到不同的节点上

哈希算法的评价标准：

* 平衡性：哈希的结果应该保证Key尽可能的均衡分布到各个节点
* 单调性：当集群发生变化时，已经被哈希到某节点上的Key，尽量还能够分配到该节点上，以防止大量的缓存失效和数据迁移

## 基本原理

* 将Key和节点标识Key分别进行哈希运算，并按照一定规律得到0-2^32-1之间的值

* 将哈希环的大小设置为2^32，Key和节点标识Key的哈希值分别为其在哈希环上面的位置

* 对于Key，按照顺时针方向找到第一个大于节点标识Key的位置，此时便认为该Key属于该节点

![img](/images/一致性哈希之哈希环.png)

* 当增加节点或删除节点时，只需要重新进行分配即可

！[img](/images/一致性哈希之节点失效.png)

* 使用虚拟节点保证平衡性

## 实现
