<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=5.1.4">


  <link rel="mask-icon" href="/images/favicon.ico?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="Yihang&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="Yihang&#39;s Blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Yihang&#39;s Blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/3/">





  <title>Yihang's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Yihang's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/12/Elasticsearch-Query查询/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yihang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yihang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/12/Elasticsearch-Query查询/" itemprop="url">Elasticsearch-Query查询</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-12T13:47:19+08:00">
                2019-02-12
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Elasticsearch/" itemprop="url" rel="index">
                    <span itemprop="name">Elasticsearch</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/12/Elasticsearch-Query查询/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/02/12/Elasticsearch-Query查询/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>简单的Query查询</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET /index1/user/_search?q=name:zhangsan  //单字段匹配</span><br><span class="line"></span><br><span class="line">GET /index1/user/_search?q=name:zhangsan&amp;_source=name,age  // 单字段匹配，指定需要返回的字段</span><br><span class="line"></span><br><span class="line">GET /index1/user/_search?q=interests:changge&amp;sort=age:desc  // 单字段匹配，指定返回的多个文档的排序规则，默认按照相似度的score值进行降序返回</span><br></pre></td></tr></table></figure>
<ul>
<li>term和terms查询</li>
</ul>
<p>向倒排索引中寻找确切的term，不对查询字段进行分词，该查询适合字符串、数值型和日期型等数据类型<br>适合<code>精确查找</code><br>term查询: 查询某个字段中包含某个关键词的文档<br>terms查询: 查询某个字段中包含多个关键词的查询</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">GET /index1/user/_search</span><br><span class="line">&#123;"query": &#123;"term": &#123;"interests": "changge"&#125;&#125;&#125;   // 单一关键词查询</span><br><span class="line"></span><br><span class="line">GET /index1/user/_search</span><br><span class="line">&#123;"query": &#123;"terms": &#123;"interests": ["changge", "tiaowu"]&#125;&#125;&#125;   // 多个关键词查询，满足一个即可</span><br><span class="line"></span><br><span class="line">GET /index1/user/_search</span><br><span class="line">&#123;"query": &#123;"terms": &#123;"interests": ["changge", "tiaowu"]&#125;&#125;, "from": 0, "size": 2&#125;   // 规定返回文档的偏移量和数量</span><br><span class="line"></span><br><span class="line">GET /index1/user/_search</span><br><span class="line">&#123;"version": true, "query": &#123;"term": &#123;"interests": "changge"&#125;&#125;&#125;   // 返回文档的版本号</span><br><span class="line"></span><br><span class="line">GET /index1/user/_search</span><br><span class="line">&#123;"query": &#123;"term": &#123;"interests": "changge"&#125;&#125;, "sort": [&#123;"age": &#123;"order": "desc"&#125;&#125;]&#125;   // 规定返回文档的排序方式</span><br><span class="line"></span><br><span class="line">GET /index1/user/_search</span><br><span class="line">&#123;"_source": ["address", "name"], "query": &#123;"term": &#123;"interests": "changge"&#125;&#125;&#125;   // 规定返回文档中的字段</span><br></pre></td></tr></table></figure>
<ul>
<li>match查询</li>
</ul>
<p>match查询会对输入的查询字段先进行分词操作，然后再查询</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">GET /index1/user/_search</span><br><span class="line">&#123;"query":&#123;"match":&#123;"interests": "changge tiaowu"&#125;&#125;&#125;  // 先分词，再分别对分词的每一个结果进行查询</span><br><span class="line"></span><br><span class="line">GET /index1/user/_search</span><br><span class="line">&#123;"query":&#123;"match":&#123;"age": 23&#125;&#125;&#125;</span><br><span class="line"></span><br><span class="line">GET /index1/user/_search</span><br><span class="line">&#123;"query":&#123;"match_all":&#123;&#125;&#125;&#125;   // 使用match_all来查询所有文档</span><br><span class="line"></span><br><span class="line">GET /index1/user/_search</span><br><span class="line">&#123;"query":&#123;"multi_match":&#123;"query":"changge","fields":["interests","name"]&#125;&#125;&#125; // 使用multi_match来查询多个字段</span><br><span class="line"></span><br><span class="line">GET /index1/user/_search</span><br><span class="line">&#123;"query":&#123;"match_phrase":&#123;"interests":"chang ge tiao wu"&#125;&#125;&#125; // 使用match_phrase来进行短语匹配查询，意味着必须匹配所有分词结果，且各个分词的相对位置不变</span><br><span class="line"></span><br><span class="line">GET /index1/user/_search</span><br><span class="line">&#123;"query": &#123;"match_phrase_prefix": &#123;"interests": "changg"&#125;&#125;&#125;  // 使用match_phrase_prefix来进行前缀匹配查询，只需要分词的前缀匹配即可</span><br></pre></td></tr></table></figure>
<ul>
<li>range查询</li>
</ul>
<p>查询某字段值在某个范围的文档，适合数值型和日期型字段</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET /index1/user/_search</span><br><span class="line">&#123;"query":&#123;"range":&#123;"age":&#123;"gt":20,"lte":30&#125;&#125;&#125;&#125;</span><br><span class="line"></span><br><span class="line">GET /index1/user/_search</span><br><span class="line">&#123;"query":&#123;"range":&#123;"birthday":&#123;"gte":"1970-10-12","lt":"1987-05-05"&#125;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>wildcard查询</li>
</ul>
<p>使用通配符<code>*</code>和<code>?</code>进行查询，<code>*</code>代表0个或多个字符，<code>?</code>代表一个字符</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /index1/user/_search</span><br><span class="line">&#123;"query":&#123;"wildcard":&#123;"name": "zh?o*"&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>fuzzy查询</li>
</ul>
<p>当对搜索的字符的精确值不清楚时，可以使用fuzzy进行模糊查询</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /index1/user/_search</span><br><span class="line">&#123;"query":&#123;"fuzzy":&#123;"name": "lii"&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>exist查询</li>
</ul>
<p>判断文档中的某个字段的字段值是否为空<br>类似于SQL中的<code>IS NOT NULL</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /index1/user/_search</span><br><span class="line">&#123;"query":&#123;"exists":&#123;"field":"age"&#125;&#125;&#125;  // 获取age字段不为空的所有文档</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/11/Elasticsearch-文档版本控制/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yihang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yihang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/11/Elasticsearch-文档版本控制/" itemprop="url">Elasticsearch 文档版本控制</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-11T17:58:10+08:00">
                2019-02-11
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Elasticsearch/" itemprop="url" rel="index">
                    <span itemprop="name">Elasticsearch</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/11/Elasticsearch-文档版本控制/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/02/11/Elasticsearch-文档版本控制/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ES使用乐观锁来保证文档数据的一致性，即每个用户对同一个文档的更新或删除操作并不需要进行加锁和解锁的操作，只需要提供要操作的文档版本号即可</p>
<p>内部版本控制: ES的默认版本控制，使用文档的_version字段。当操作提供的版本号与文档当前版本号一致时，ES允许操作顺利进行并将版本号递增，否则提示版本号冲突并抛出异常; 文档内部版本号为[1, 2^63-1]</p>
<p>外部版本控制: 判断操作提供的版本号是否大于文档当前版本号，如果大于，则允许操作顺利进行并将版本号改为提供的版本号，否则提示版本冲突并抛出异常；需要将设置version_type=external</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">PUT index3/weather/1?version=4  // 使用内部版本控制</span><br><span class="line">&#123;</span><br><span class="line">  "name": "NJ",</span><br><span class="line">  "status": "Rainy"</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT index3/weather/2?version=5&amp;version_type=external  // 使用外部版本控制</span><br><span class="line">&#123;</span><br><span class="line">  "name": "SH",</span><br><span class="line">  "status": "Sunny"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/11/Elasticsearch-Mapping/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yihang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yihang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/11/Elasticsearch-Mapping/" itemprop="url">Elasticsearch Mapping</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-11T17:47:19+08:00">
                2019-02-11
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Elasticsearch/" itemprop="url" rel="index">
                    <span itemprop="name">Elasticsearch</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/11/Elasticsearch-Mapping/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/02/11/Elasticsearch-Mapping/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Mapping是用于描述文档schema的，即对文档中各个字段的数据类型、如何进行分词、是否建立索引等进行描述</p>
<p>在添加文档时，ES会根据插入的文档，自动创建Mapping，可以使用<code>GET /index1/user/_mapping</code>来查看</p>
<p>也可以在创建索引时，手动创建Mapping</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">PUT index4</span><br><span class="line">&#123;</span><br><span class="line">  "mappings": &#123;</span><br><span class="line">    "books": &#123;</span><br><span class="line">      "properties": &#123;</span><br><span class="line">        "ids": &#123;</span><br><span class="line">          "type": "long"</span><br><span class="line">        &#125;,</span><br><span class="line">        "price": &#123;</span><br><span class="line">          "type": "long"</span><br><span class="line">        &#125;,</span><br><span class="line">        "title": &#123;</span><br><span class="line">          "type": "text",</span><br><span class="line">          "fields": &#123;</span><br><span class="line">            "keyword": &#123;</span><br><span class="line">              "type": "keyword",</span><br><span class="line">              "ignore_above": 256</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Mapping中常用的字段数据类型:</p>
<ul>
<li>核心数据类型<ul>
<li>字符型: string, 包括text和keyword<ul>
<li>text: 对长文本进行索引，在建立索引时对其进行分词，不可用于排序和聚合</li>
<li>keyword: 不需要进行分词，只可以使用本身来进行检索过滤，还可以用来排序和聚合</li>
</ul>
</li>
<li>数值型: long, integer, short, byte, double, float，不进行分词</li>
<li>日期型: date，不进行分词</li>
<li>布尔型: boolean，不进行分词</li>
<li>二进制型: binary，不进行分词</li>
</ul>
</li>
<li>复杂数据类型<ul>
<li>数组类型: json数组</li>
<li>对象类型: _object json对象</li>
<li>嵌套类型: _nested</li>
</ul>
</li>
<li>地理位置类型<ul>
<li>地理坐标类型: _geo_point</li>
<li>地理形状类型: _geo_shape</li>
</ul>
</li>
<li>其他</li>
</ul>
<p>Mapping描述字段常用的属性:</p>
<ul>
<li>store: false 字段不单独进行存储</li>
<li>index: true 是否对该字段进行分词</li>
<li>analyzer: ik 指定分词器，默认为standard</li>
<li>boost: 1.23 字段级别的分数加权</li>
<li>ignore_above: 100 字段值的长度超过该值，则进行忽略，不被索引</li>
<li>search_analyzer: ik 默认与analyzer一致</li>
<li>其他</li>
</ul>
<p>在基于字段进行查询时，该字段的mapping决定了查询方式</p>
<ul>
<li>text类型基于分词结果进行查询，因此可以进行模糊匹配</li>
<li>其他类型不进行分词，必须使用全字匹配来进行查询，因此只可以进行精确匹配</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET /index1/user/_search?q=first_name:Douglas</span><br><span class="line">GET index1/user/_search?q=age:2</span><br><span class="line">GET index1/user/_search?q=age:23</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/11/Elasticsearch-API/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yihang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yihang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/11/Elasticsearch-API/" itemprop="url">Elasticsearch API</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-11T17:47:05+08:00">
                2019-02-11
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Elasticsearch/" itemprop="url" rel="index">
                    <span itemprop="name">Elasticsearch</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/11/Elasticsearch-API/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/02/11/Elasticsearch-API/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>ES提供了Restful接口对索引、类型和文档进行CURD操作</p>
<h2 id="基本的CURD"><a href="#基本的CURD" class="headerlink" title="基本的CURD"></a>基本的CURD</h2><ul>
<li>添加索引</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PUT index1</span><br><span class="line">&#123;</span><br><span class="line">"settings" : &#123;</span><br><span class="line">      "index" : &#123;</span><br><span class="line">        "number_of_shards" : "3",  // 分片</span><br><span class="line">        "number_of_replicas" : "1"  // 副本</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>查看索引</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET _all  // 获取所有索引</span><br><span class="line">GET index1</span><br></pre></td></tr></table></figure>
<ul>
<li>删除索引</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE index1</span><br></pre></td></tr></table></figure>
<ul>
<li>添加文档</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">PUT index1/user/1  // 索引名称/类型名称/文档ID</span><br><span class="line">&#123;</span><br><span class="line">  "first_name": "Jane",</span><br><span class="line">  "last_name": "Smith",</span><br><span class="line">  "age": 32,</span><br><span class="line">  "about": "I like to collect rock albums",</span><br><span class="line">  "interests": [</span><br><span class="line">    "music"</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST index1/user  // 索引名称/类型名称</span><br><span class="line">&#123;</span><br><span class="line">  "first_name": "Douglas",</span><br><span class="line">  "last_name": "Fir",</span><br><span class="line">  "age": 23,</span><br><span class="line">  "about": "I like to build cabinets",</span><br><span class="line">  "interests": [</span><br><span class="line">    "forestry"</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>查看文档</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET index1/user/1</span><br><span class="line">GET index1/user/1?_source=first_name,about   // 查看特定字段</span><br></pre></td></tr></table></figure>
<ul>
<li>更新文档</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">PUT index1/user/1  // 用新的文档覆盖当前文档</span><br><span class="line">&#123;</span><br><span class="line">  "first_name": "Jane",</span><br><span class="line">  "last_name": "Smith",</span><br><span class="line">  "age": 33,</span><br><span class="line">  "about": "I like to collect rock albums",</span><br><span class="line">  "interests": [</span><br><span class="line">    "music",</span><br><span class="line">    "football",</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST index1/user/1/_update  // 可以单独更新某些字段</span><br><span class="line">&#123;</span><br><span class="line">  "doc": &#123;</span><br><span class="line">    "age": 34</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>删除文档</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE index1/user/1</span><br></pre></td></tr></table></figure>
<h2 id="基于MultiGet的批量文档查询"><a href="#基于MultiGet的批量文档查询" class="headerlink" title="基于MultiGet的批量文档查询"></a>基于MultiGet的批量文档查询</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">GET /_mget    // 获取不同索引，不同类型下的不同文档</span><br><span class="line">&#123;</span><br><span class="line">  "docs": [</span><br><span class="line">    &#123;</span><br><span class="line">      "_index": "index1",</span><br><span class="line">      "_type": "user",</span><br><span class="line">      "_id": 1,</span><br><span class="line">      "_source": [  // 还可以指定返回的字段列表</span><br><span class="line">        "first_name",</span><br><span class="line">        "age"</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      "_index": "index1",</span><br><span class="line">      "_type": "user",</span><br><span class="line">      "_id": 2</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET index1/user/_mget  // 获取相同索引，相同类型下的多个文档</span><br><span class="line">&#123;</span><br><span class="line">  "docs": [</span><br><span class="line">    &#123;</span><br><span class="line">      "_id": 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      "_id": 2</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET index1/user/_mget  // 获取相同索引，相同类型下的多个文档</span><br><span class="line">&#123;</span><br><span class="line">  "ids":[1,2]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="基于Bulk的批量文档操作"><a href="#基于Bulk的批量文档操作" class="headerlink" title="基于Bulk的批量文档操作"></a>基于Bulk的批量文档操作</h2><p>bulk的格式:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;action:&#123;metadata&#125;&#125;</span><br><span class="line">&#123;request_body&#125;</span><br></pre></td></tr></table></figure>
<p>action表示操作类型:</p>
<ul>
<li>create: 批量添加，如果文档已存在则添加失败，此时必须指定文档ID</li>
<li>update: 批量更新</li>
<li>index: 批量添加或替换已存在的文档，可以不指定文档ID，此时ES添加文档并生成ID</li>
<li>delete: 批量删除</li>
</ul>
<p>metadata表示文档所属的索引、类型和ID<br>request_body为文档具体内容</p>
<p>批量添加文档</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST /index2/books/_bulk</span><br><span class="line">&#123;"create":&#123;"_id":1&#125;&#125;</span><br><span class="line">&#123;"title":"Java","price":55&#125;</span><br><span class="line">&#123;"create":&#123;"_id":2&#125;&#125;</span><br><span class="line">&#123;"title":"C++","price":65&#125;</span><br><span class="line">&#123;"create":&#123;"_id":3&#125;&#125;</span><br><span class="line">&#123;"title":"Golang","price": 45&#125;</span><br></pre></td></tr></table></figure>
<p>批量更新文档</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST /index2/books/_bulk</span><br><span class="line">&#123;"update":&#123;"_id":1&#125;&#125;</span><br><span class="line">&#123;"doc":&#123;"title":"Java1"&#125;&#125;</span><br><span class="line">&#123;"update":&#123;"_id":2&#125;&#125;</span><br><span class="line">&#123;"doc":&#123;"title":"C++1"&#125;&#125;</span><br><span class="line">&#123;"update":&#123;"_id":3&#125;&#125;</span><br><span class="line">&#123;"doc":&#123;"title":"Golang1"&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>批量删除文档</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">POST /index2/books/_bulk</span><br><span class="line">&#123;"delete":&#123;"_id":1&#125;&#125;  // 删除操作不需要请求体</span><br><span class="line">&#123;"delete":&#123;"_id":2&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>批量混合操作</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST /index2/books/_bulk</span><br><span class="line">&#123;"create":&#123;"_id":1&#125;&#125;</span><br><span class="line">&#123;"title":"Java","price":55&#125;</span><br><span class="line">&#123;"delete":&#123;"_id":3&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>bulk操作是将待处理的数据载入到内存当中，因此其对数据大小有限制<strong>一般建议文档数最大为1000-5000个，数据大小最大为5-15MB</strong></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/11/CPU-GPU-FPGA-ASIC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yihang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yihang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/11/CPU-GPU-FPGA-ASIC/" itemprop="url">CPU GPU FPGA ASIC</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-11T10:26:50+08:00">
                2019-02-11
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Computer-Architecture/" itemprop="url" rel="index">
                    <span itemprop="name">Computer Architecture</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/02/11/CPU-GPU-FPGA-ASIC/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/02/11/CPU-GPU-FPGA-ASIC/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li><p>数据的训练: 使用CPU或GPU</p>
<ul>
<li>CPU VS GPU<ul>
<li>相同点<ul>
<li>基于摩尔定律，该定律已步入晚年</li>
<li>基于冯·诺依曼体系结构，指令译码执行、共享内存，主要包含控制器(Control)、寄存器(Cache、DRAM)和算术逻辑部件运算器(Arithmetic Logical Unit)等</li>
<li>指令流的控制逻辑复杂，不可能有太多条独立的指令流，因此使用SIMD(单指令流多数据流)来让多个执行单元以同样的步调处理不同的数据</li>
<li>使用内存来保存中间状态和进行单元间的通信，由于内存是共享的，因此需要提供访问仲裁的机制</li>
<li>为了利用内存访问的局部性，每一个执行单元都有一个私有的缓存，因此需要提供维持缓存一致性的机制</li>
</ul>
</li>
<li>不同点<ul>
<li>CPU的执行单元可以执行任意指令，需要提供分支跳转处理逻辑等，因此控制器和寄存器占据了较大部分；GPU只需要进行高速运算，而不需要分支跳转处理逻辑等，因此ALU占据了较大部分</li>
<li>CPU是基于低延时的设计，使用缓存、分支预测等降低延时；GPU是基于大吞吐量的设计，使用大量的可以并行执行的ALU来进行运算</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>数据的推断: 使用FPGA或ASIC</p>
<ul>
<li>FPGA(Field Programmable Gate Array，现场可编程门阵列)<ul>
<li>无指令、无需共享内存的体系结构</li>
<li>可以使用MIMD(多指令流多数据流)来执行</li>
<li>每个逻辑单元的功能在重编程(烧写)时就已经确定，不需要指令</li>
<li>寄存器和片上内存(BRAM)是属于各自的控制逻辑，无需内存访问仲裁和私有缓存</li>
</ul>
</li>
<li>ASIC(Application Specific Integrated Circuit，专用芯片)<ul>
<li>研发成本高，周期长</li>
<li>针对特定功能深度学习算法量身定做，灵活性比FPGA差</li>
</ul>
</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/25/Elasticsearch入门/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yihang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yihang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/25/Elasticsearch入门/" itemprop="url">Elasticsearch入门</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-25T17:35:48+08:00">
                2019-01-25
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Elasticsearch/" itemprop="url" rel="index">
                    <span itemprop="name">Elasticsearch</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/25/Elasticsearch入门/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/01/25/Elasticsearch入门/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>一个基于lucene的分布式多用户的存储和全文搜索引擎，提供Restful接口</p>
<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><ul>
<li><p>Index: 索引，类似于mysql中的database</p>
</li>
<li><p>Type: 类型，类似于mysql中的table</p>
</li>
<li><p>Document: JSON文档，类似于mysql中的row</p>
<ul>
<li>包含多个Field</li>
</ul>
</li>
<li><p>Mapping: JSON文档的schema，类似于mysql中的table schema</p>
</li>
<li><p>QueryDSL: 查询语句，类似于mysql中的sql语句</p>
</li>
<li><p>GET/PUT/POST/DELETE: Restful接口，实现文档的增删改查</p>
</li>
</ul>
<h2 id="基本功能"><a href="#基本功能" class="headerlink" title="基本功能"></a>基本功能</h2><ul>
<li><p>倒排索引</p>
<ul>
<li>对所有文档中的内容进行分词，得到单词列表<ul>
<li>Elasticsearch会使用标准化规则来处理单词中的大小写、单复数、同义词等问题，提高查询的命中率</li>
</ul>
</li>
<li>为每一个单词，赋予唯一的ID</li>
<li>建立文档中的单词ID与文档ID的关系</li>
<li>还可以记录每一个单词在文档中出现的次数称为单词频率信息、每一个单词在文档中出现的位置等</li>
<li>这样便通过分词获取到相关的文档，还可以通过单词频率信息确定单词与文档的相似度以进行排序</li>
</ul>
</li>
<li><p>分词器: 从一串文本中切分出一个一个的词条，同时对每一个词条进行标准化处理</p>
<ul>
<li>处理过程<ul>
<li>character filter: 分词前的预处理，如过滤HTML标签、特殊符号转换等</li>
<li>tokenizer: 分词操作</li>
<li>token filter: 标准化操作</li>
</ul>
</li>
<li>内置分词器<ul>
<li>standard: 默认分词器，将词汇单元转换为小写形式，去除停用词和标点符号，支持中文的单字切分</li>
<li>simple: 使用非字母字符来分割文本信息，将词汇单元统一为小写形式，去除数字类型的字符</li>
<li>whitespace: 仅去除空格，不支持中文</li>
<li>language: 特定语言的分词器，不支持中文</li>
</ul>
</li>
<li>中文分词器: <a href="https://github.com/medcl/elasticsearch-analysis-ik/" target="_blank" rel="noopener">ik</a></li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/24/Golang-内存对齐/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yihang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yihang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/24/Golang-内存对齐/" itemprop="url">Golang-内存对齐</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-24T17:35:23+08:00">
                2019-01-24
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Golang/" itemprop="url" rel="index">
                    <span itemprop="name">Golang</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/24/Golang-内存对齐/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/01/24/Golang-内存对齐/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>与C++一样，在Golang中计算某个结构体占用的内存大小时，需要考虑到内存对齐的影响</p>
<p>在Golang中可以</p>
<ul>
<li>使用<code>unsafe.Sizeof()</code>获取某个数据类型占用的内存字节大小</li>
<li>使用<code>unsafe.Alignof()</code>获取某个数据类型的对齐系数</li>
<li>使用<code>unsafe.Offsetof()</code>获取某个结构体的成员变量相对于结构体起始地址的偏移量</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MyStruct <span class="keyword">struct</span>&#123;</span><br><span class="line">    a <span class="keyword">bool</span> <span class="comment">// 1 Byte</span></span><br><span class="line">    b <span class="keyword">int32</span> <span class="comment">// 4 Byte</span></span><br><span class="line">    c <span class="keyword">int8</span>  <span class="comment">// 1 Byte</span></span><br><span class="line">    d <span class="keyword">int64</span> <span class="comment">// 8 Byte</span></span><br><span class="line">    e <span class="keyword">byte</span>  <span class="comment">// 1 Byte</span></span><br><span class="line">    f <span class="keyword">float64</span> <span class="comment">// 8 Byte</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到MyStruct中所有字段加起来占用的内存大小为1+4+1+8+1+8=23个字节<br>但是获取到的MyStruct对象占用的内存却是40个字节，原因便是因为需要进行内存对齐</p>
<p>内存对齐产生的原因: 内存可以看做是字节数组，但是实际上CPU并不会一个一个字节的读取和写入内存，而是一块一块的读取，块的大小我们称为<code>对齐系数</code></p>
<p>结构体的对齐规则:</p>
<ul>
<li>默认对齐系数</li>
</ul>
<p>一般来讲，常用平台的默认系统系数为32位-&gt;4, 64位-&gt;8<br>可以使用预编译命令<code>#pragma pack(n)</code>来改变编译器的默认对齐系数</p>
<ul>
<li>结构体成员对齐</li>
</ul>
<p>结构体中每一个成员的都有对齐系数<br>第一个成员变量的偏移量为0，往后的每一个成员的对齐值必须为 min(默认对齐系数, 当期成员变量的内存字节长度)<br>每一个成员的偏移量必须为其对齐值的整数倍</p>
<ul>
<li>结构体整体对齐</li>
</ul>
<p>整个结构体本身也需要做字节对齐<br>结构体的对齐值必须为 min(默认对齐系数，结构体中成员变量中的最大对齐值)<br>偏移量为结构体对齐值的整数倍</p>
<p>因此，如果结构体中定义的字段顺序不同，那么结构体本身占用的内存大小也会不同，比如下面的结构，MyStruct对象占用的内存只有24个字节</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MyStruct <span class="keyword">struct</span> &#123;</span><br><span class="line">    a <span class="keyword">bool</span>    <span class="comment">// 1 Byte</span></span><br><span class="line">    e <span class="keyword">byte</span>    <span class="comment">// 1 Byte</span></span><br><span class="line">    c <span class="keyword">int8</span>    <span class="comment">// 1 Byte</span></span><br><span class="line">    b <span class="keyword">int32</span>   <span class="comment">// 4 Byte</span></span><br><span class="line">    d <span class="keyword">int64</span>   <span class="comment">// 8 Byte</span></span><br><span class="line">    f <span class="keyword">float64</span> <span class="comment">// 8 Byte</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/23/Git-基本操作/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yihang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yihang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/23/Git-基本操作/" itemprop="url">Git-基本操作</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-23T14:05:31+08:00">
                2019-01-23
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Git/" itemprop="url" rel="index">
                    <span itemprop="name">Git</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/23/Git-基本操作/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/01/23/Git-基本操作/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Git是流行的分布式版本控制系统。</p>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 设置全局的用户名和邮箱，在每次提交中将会使用该配置</span><br><span class="line">git config --global user.name "yihang.xin"</span><br><span class="line">git config --global user.email "xyh_nju@163.com"</span><br></pre></td></tr></table></figure>
<h2 id="初始化版本库"><a href="#初始化版本库" class="headerlink" title="初始化版本库"></a>初始化版本库</h2><p>Repository，成为代码仓库或代码版本库</p>
<ul>
<li>创建新的Repository</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir myRepo</span><br><span class="line">cd myRepo</span><br><span class="line"><span class="meta">#</span> 进行版本库初始化，生成.git文件夹，用于存放git相关信息</span><br><span class="line">git init</span><br></pre></td></tr></table></figure>
<ul>
<li>克隆远程Repository到本地</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone git@github.com:userName/projectName.git</span><br></pre></td></tr></table></figure>
<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><ul>
<li><p>工作区(Working Directory): 当前的工作目录</p>
</li>
<li><p>暂存区(Stage): 保存尚未提交到本地版本库中的修改</p>
</li>
<li><p>本地版本库(Repository)</p>
<ul>
<li>对于工作区中.git隐藏目录</li>
<li>其中包含了各个分支，各个分支最新提交(HEAD)等信息</li>
<li>文件的修改必须先添加到暂存区，然后才可以提交到本地版本库</li>
</ul>
</li>
</ul>
<p><img src="/images/git之本地仓库.png" alt="Git本地仓库"></p>
<ul>
<li>远程版本库<ul>
<li>可以克隆远程版本库</li>
<li>可以从远程版本库拉取更新或将本地更新推送到远程版本库</li>
</ul>
</li>
</ul>
<p><img src="/images/git之远程仓库.png" alt="Git远程仓库"></p>
<p>GitHub是免费的Git服务器，可以将个人仓库放在上面</p>
<p><img src="/images/git之GitHub使用流程.png" alt="GitHub使用流程"></p>
<h2 id="文件状态操作"><a href="#文件状态操作" class="headerlink" title="文件状态操作"></a>文件状态操作</h2><p><img src="/images/git之本地仓库文件状态流转.png" alt="Git文件状态流转"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 查看版本库状态</span><br><span class="line">git status</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 将文件添加到暂存区，在.git目录中建立索引</span><br><span class="line">git add file.go</span><br><span class="line"><span class="meta">#</span> 将文件中尚未提交到暂存区的的修改撤销，恢复到和暂存区相同的状态</span><br><span class="line">git checkout file.go</span><br><span class="line"><span class="meta">#</span> 将文件中已经提交到暂存区的修改进行撤销，将修改放回到工作区</span><br><span class="line">git reset HEAD file.go</span><br><span class="line"><span class="meta">#</span> 在git中，删除文件也是一种修改</span><br><span class="line">git rm file.go</span><br><span class="line"><span class="meta">#</span> 将文件的修改提交到本地仓库的分支</span><br><span class="line">git commit -m "commit message"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 查看提交的历史记录</span><br><span class="line"><span class="meta">#</span> commit: 提交的ID</span><br><span class="line"><span class="meta">#</span> 使用HEAD表示当前分支最新的版本，也就是最新的提交ID</span><br><span class="line">git log</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 在本地仓库的当前分支上进行版本回退，可以回退到HEAD之前或之后的任意提交</span><br><span class="line">git reset --hard commitID</span><br><span class="line"><span class="meta">#</span> 在本地仓库进行版本回退后，如果希望进行恢复，那么需要知道HEAD后一次的commitID</span><br><span class="line"><span class="meta">#</span> 查看当前分支所有的commitID</span><br><span class="line">git reflog</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 为本地仓库添加远程仓库，命名为origin</span><br><span class="line">git remote add origin git@github.com:userName/projectName.git</span><br><span class="line"><span class="meta">#</span> 查看远程仓库信息</span><br><span class="line">git remote -v</span><br><span class="line"><span class="meta">#</span> 与远程仓库分支建立关联并将文件提交到远程仓库的分支</span><br><span class="line">git push --set-upstream origin master</span><br></pre></td></tr></table></figure>
<h2 id="分支管理"><a href="#分支管理" class="headerlink" title="分支管理"></a>分支管理</h2><p>保证多项任务的同时进行，如同时开发多功能，或一边开发功能一边修改bug</p>
<ul>
<li>分支创建，修改，合并的过程</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 基于当前master分支，创建dev分支</span><br><span class="line">git branch dev</span><br><span class="line"><span class="meta">#</span> 将当前工作区切换到dev分支</span><br><span class="line">git checkout dev</span><br><span class="line"><span class="meta">#</span> 查看当前工作的分支</span><br><span class="line">git branch</span><br><span class="line"><span class="meta">#</span> 在dev分支上进行修改并提交</span><br><span class="line">git commit -a -m "first commit on branch dev"</span><br><span class="line"><span class="meta">#</span> 切换到master分支</span><br><span class="line">git checkout master</span><br><span class="line"><span class="meta">#</span> 将dev分支的修改merge到master分支上，此时master分支和dev分支对齐</span><br><span class="line">git merge dev</span><br><span class="line"><span class="meta">#</span> 将修改推送到远程仓库</span><br><span class="line">git push</span><br><span class="line"><span class="meta">#</span> 删除不再使用的dev分支</span><br><span class="line">git branch -d dev</span><br></pre></td></tr></table></figure>
<ul>
<li>合并分支时手动解决冲突<ul>
<li>在执行<code>git merge</code>时，有可能出现当前分支的修改与被合并的分支的修改之间出现冲突的情况</li>
<li>此时需要在本地手动修改发生冲突的文件内容，然后再进行一次提交</li>
</ul>
</li>
</ul>
<p>解决冲突后的历史记录:<img src="/images/git之解决冲突.png" alt="解决冲突后的历史记录"></p>
<ul>
<li>合并分支时禁用快进模式(Fast-forward)<ul>
<li>Git在进行合并时，默认会尝试使用快进模式，即只移动分支的HEAD指针进行合并</li>
<li>此时生成的提交记录是线性的，但是当被合并的分支被删除之后，在提交记录中会丢失此次合并的信息</li>
<li>可以在执行<code>git merge</code>时使用<code>--no-ff</code>模式，此时Git会在合并时生成一个新的commit</li>
</ul>
</li>
</ul>
<p>快进合并后的历史记录:<img src="/images/git之Fast-forward合并模式.png" alt="快进合并后的历史记录"></p>
<p>非快进合并后的历史记录:<img src="/images/git之非Fast-forward合并模式.png" alt="非快进合并后的历史记录"></p>
<ul>
<li>临时保存工作区的修改</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 当前在feature1分支，保存工作区的修改</span><br><span class="line">git stash</span><br><span class="line"><span class="meta">#</span> 查看stash中的内容</span><br><span class="line">git stash list</span><br><span class="line"><span class="meta">#</span> 切换到另一个分支</span><br><span class="line">git checkout feature2</span><br><span class="line"><span class="meta">#</span> 修改并提交</span><br><span class="line">git commit -a -m "fix bug"</span><br><span class="line"><span class="meta">#</span> 切换到feature1分支</span><br><span class="line">git checkout feature1</span><br><span class="line"><span class="meta">#</span> 恢复工作区，继续进行修改</span><br><span class="line">git stash pop</span><br></pre></td></tr></table></figure>
<ul>
<li>分支合并与分支变基<ul>
<li>在进行分支合并时，可以使用<code>git merge</code>操作，但是有可能因为出现冲突或使用非快进的模式导致出现一个新的commit，从而使得提交记录是非线性的</li>
<li>可以使用<code>git rebase</code>进行变基操作，可以得到线性的提交记录</li>
<li>变基操作的原理<ul>
<li>找出分支feature1和master中最后相同的一次提交commitA</li>
<li>将feature1分支中commitA后的下一次提交移动到master的最后一次提交之后</li>
<li>此时，feature1分支中的历史记录变为线性</li>
</ul>
</li>
<li>将feature1分支合并到master分支上<ul>
<li>切换到master分支</li>
<li>执行<code>git merge feature1</code></li>
</ul>
</li>
<li>将feature1分支变基到master分支上<ul>
<li>切换到feature1分支</li>
<li>执行<code>git rebase master</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 此时处于feature1分支，对其进行变基</span><br><span class="line">git rebase master</span><br><span class="line"><span class="meta">#</span> 切换到master分支</span><br><span class="line">git checkout master</span><br><span class="line"><span class="meta">#</span> 对master分支执行变基，此时feature1上面的修改全部合并到master分支中</span><br><span class="line">git rebase feature1</span><br></pre></td></tr></table></figure>
<h2 id="标签管理"><a href="#标签管理" class="headerlink" title="标签管理"></a>标签管理</h2><p>标签(Tag)可以看做是执行某次commit的指针，保存了某次commit对应的版本快照，只不过标签不能够在commit上进行移动</p>
<p>可以使用标签进行版本管理，在发布版本时给代码库打一个标签，从而方便查找历史版本的代码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 创建标签</span><br><span class="line">git tag v1.0</span><br><span class="line"><span class="meta">#</span> 查看存在的标签列表</span><br><span class="line">git tag</span><br><span class="line"><span class="meta">#</span> 查看标签信息</span><br><span class="line">git show v1.0</span><br><span class="line"><span class="meta">#</span> 创建的标签默认在本地，可以将标签推送至远程仓库</span><br><span class="line">git push origin v1.0</span><br><span class="line"><span class="meta">#</span> 将本地所有的标签推送到远程仓库</span><br><span class="line">git push --tags</span><br><span class="line"><span class="meta">#</span> 删除标签</span><br><span class="line">git tag -d v1.0</span><br><span class="line"><span class="meta">#</span> 删除远程仓库的标签</span><br><span class="line">git push origin :refs/tags/v1.0</span><br></pre></td></tr></table></figure>
<h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><ul>
<li>使用<code>.gitignore</code>将特定文件从仓库中忽略</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/22/Golang-slice/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yihang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yihang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/22/Golang-slice/" itemprop="url">Golang-slice</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-22T17:25:33+08:00">
                2019-01-22
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Golang/" itemprop="url" rel="index">
                    <span itemprop="name">Golang</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/22/Golang-slice/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/01/22/Golang-slice/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>golang中的slice(切片)是基于array(数组)上的内置类型，可以看做是能够自动扩容的动态数组<br>与内置的map, chan一样，都是引用类型</p>
<h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2><ul>
<li>array<ul>
<li>需要指定数组元素类型和数组长度</li>
<li>底层为连续的内存空间，使用下标作为索引来进行存取</li>
<li>声明后，数组元素为零值</li>
<li>数组长度也是数组类型的一部分，因此<code>[3]int</code>和<code>[4]int</code>不是同一个类型</li>
</ul>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    nums := [<span class="number">3</span>]<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">    nums[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">    n := nums[<span class="number">0</span>]</span><br><span class="line">    n = <span class="number">2</span></span><br><span class="line">    fmt.Printf(<span class="string">"nums: %v\n"</span>, nums)</span><br><span class="line">    fmt.Printf(<span class="string">"n: %d\n"</span>, n)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>slice<ul>
<li>底层为数组</li>
<li>不需要指定切片的长度</li>
<li>使用<code>var []T</code>, <code>[]T{}</code>或 <code>make([]T, len, cap)</code>来创建</li>
<li>使用<code>append</code>来增加元素，可以自动扩容</li>
<li>使用<code>copy</code>来进行切片的拷贝，返回被复制的元素数</li>
<li>使用<code>[start:end]</code>来进行切片的resize操作</li>
</ul>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    nums := [<span class="number">3</span>]<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">    nums[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">    dnums := nums[:]</span><br><span class="line">    fmt.Printf(<span class="string">"dnums: %v"</span>, dnums)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h2><p><img src="/images/Golang-slice的实现.png" alt="slice"></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> slice <span class="keyword">struct</span> &#123;</span><br><span class="line">    array unsafe.Pointer <span class="comment">//所引用的底层数据的指针</span></span><br><span class="line">    <span class="built_in">len</span>   <span class="keyword">int</span>  <span class="comment">// 当前切片的元素个数</span></span><br><span class="line">    <span class="built_in">cap</span>   <span class="keyword">int</span>  <span class="comment">// 当前切片的容量(底层数组的长度)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>扩容带来的问题</p>
<ul>
<li>未扩容时，对slice的修改会直接影响到底层的array</li>
<li>发送扩容时，slice不再引用底层数据，对slice的修改不再影响到底层的array</li>
</ul>
<p>empty slice和nil slice</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">emptyNums := []<span class="keyword">int</span>&#123;&#125; <span class="comment">// 切片中的array指向一个空的数组</span></span><br><span class="line"><span class="keyword">var</span> nilNums []<span class="keyword">int</span> <span class="comment">// 切片中的array为nil，不指向任何数组</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/22/Golang-corba/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yihang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yihang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/22/Golang-corba/" itemprop="url">Golang-corba</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-22T11:18:51+08:00">
                2019-01-22
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Golang/" itemprop="url" rel="index">
                    <span itemprop="name">Golang</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/22/Golang-corba/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/01/22/Golang-corba/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>使用corba库可以方便的编写cli程序，其中Docker和Kubernetes的客户端程序便是基于corba库进行开发的。</p>
<p>corba库的特点:</p>
<ul>
<li>支持子命令，如<code>app fetch</code>, <code>app push</code>等</li>
<li>兼容Posix标准的命令行模式</li>
<li>支持子命令的嵌套</li>
<li>支持全局、局部和串联的<code>Flag</code></li>
<li>使用<code>corba create appname</code>和<code>corba add cmdname</code>可以方便的创建应用程序和增加命令</li>
<li>命令输入错误时的智能提示</li>
<li>自动生成命令和Flag的帮助信息</li>
<li>默认支持<code>-h</code>和<code>--help</code>，输出帮助信息</li>
<li>Bash下命令的自动补全</li>
<li>自动生成应用的man手册信息</li>
<li>支持命令别名</li>
<li>支持自定义<code>Help</code>、<code>Usage</code>等信息</li>
</ul>
<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><ul>
<li><code>Command</code>: 命令，代表执行的动作</li>
<li><code>Arg</code>: 命令对象，代表动作对应的对象</li>
<li><code>Flag</code>: 命令参数</li>
</ul>
<p>因此，cli程序的使用方式为<code>AppName Command Arg --Flag</code>，其中<code>Command</code>还有可能包含子命令</p>
<h2 id="项目初始化"><a href="#项目初始化" class="headerlink" title="项目初始化"></a>项目初始化</h2><ul>
<li>安装:<code>go get -u github.com/spf13/cobra/cobra</code></li>
<li><p>导入: <code>import &quot;github.com/spf13/cobra&quot;</code></p>
</li>
<li><p>项目结构:</p>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">appName/</span><br><span class="line">    cmd/</span><br><span class="line">        cmd1.<span class="keyword">go</span></span><br><span class="line">        cmd2.<span class="keyword">go</span></span><br><span class="line">    main.<span class="keyword">go</span></span><br></pre></td></tr></table></figure>
<ul>
<li>main.go: 初始化corba</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"appName/cmd"</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cmd.Execute()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="使用corba命令自动生成代码"><a href="#使用corba命令自动生成代码" class="headerlink" title="使用corba命令自动生成代码"></a>使用corba命令自动生成代码</h3><ul>
<li><p>执行<code>corba init toolchain</code>: 在{GOPATH}/src/toolchain下生成应用代码</p>
</li>
<li><p>在{GOPATH}/src/toolchain下执行<code>corba add scenario</code>: 为应用程序增加命令scenario</p>
</li>
<li><p>在{GOPATH}/src/toolchain下执行<code>corba add create -p scenarioCmd</code>: 为scenario增加子命令create</p>
</li>
</ul>
<h3 id="手动编写代码"><a href="#手动编写代码" class="headerlink" title="手动编写代码"></a>手动编写代码</h3><ul>
<li><p>在{GOPATH}/src/toolchain下手动创建main.go文件，进行corba的初始化</p>
</li>
<li><p>在{GOPATH}/src/toolchain/cmd手动创建各个命令文件，对命令进行定义</p>
</li>
</ul>
<h2 id="Command对象"><a href="#Command对象" class="headerlink" title="Command对象"></a>Command对象</h2><p>命令对象是cli应用的核心，命令可能还会包括子命令</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Command <span class="keyword">struct</span> &#123;</span><br><span class="line">    Use <span class="keyword">string</span> <span class="comment">// 命令的名称</span></span><br><span class="line"></span><br><span class="line">    Aliases []<span class="keyword">string</span> <span class="comment">// 命令的别名列表</span></span><br><span class="line"></span><br><span class="line">    SuggestFor []<span class="keyword">string</span> <span class="comment">// 该命令可以被提议使用的名称列表</span></span><br><span class="line"></span><br><span class="line">    Short <span class="keyword">string</span> <span class="comment">// 命令的简短描述，在help信息中展示</span></span><br><span class="line"></span><br><span class="line">    Long <span class="keyword">string</span> <span class="comment">// 命令的详细描述，在'help &lt;this-command&gt;'中展示</span></span><br><span class="line"></span><br><span class="line">    Example <span class="keyword">string</span> <span class="comment">// 命令的使用例子</span></span><br><span class="line"></span><br><span class="line">    ValidArgs []<span class="keyword">string</span> <span class="comment">// 在Bash自动补全中的所有合法的Arg列表</span></span><br><span class="line"></span><br><span class="line">    Args PositionalArgs <span class="comment">// Arg参数校验规则函数</span></span><br><span class="line"></span><br><span class="line">    ArgAliases []<span class="keyword">string</span> <span class="comment">// Arg参数别名列表</span></span><br><span class="line"></span><br><span class="line">    BashCompletionFunction <span class="keyword">string</span> <span class="comment">// Bash自动补全时的字符串</span></span><br><span class="line"></span><br><span class="line">    Deprecated <span class="keyword">string</span> <span class="comment">// 使用已被弃用的命令时输出的字符串</span></span><br><span class="line"></span><br><span class="line">    Hidden <span class="keyword">bool</span> <span class="comment">// 命令是否隐藏，如果隐藏则不会输出给用户</span></span><br><span class="line"></span><br><span class="line">    Annotations <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span> <span class="comment">// 命令关联的KV对，用于标识命令或对命令进行分组</span></span><br><span class="line"></span><br><span class="line">    Version <span class="keyword">string</span> <span class="comment">// 命令的版本</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// *Run系列函数的执行顺序如下:</span></span><br><span class="line">    <span class="comment">//   * PersistentPreRun() 当前命令的子命令可以实现和运行</span></span><br><span class="line">    <span class="comment">//   * PreRun() 当前命令的子命令无法实现和运行</span></span><br><span class="line">    <span class="comment">//   * Run()</span></span><br><span class="line">    <span class="comment">//   * PostRun() 当前命令的子命令无法实现和运行</span></span><br><span class="line">    <span class="comment">//   * PersistentPostRun() 当前命令的子命令可以实现和运行</span></span><br><span class="line">    <span class="comment">// 所有函数的输入参数相同的Arg参数</span></span><br><span class="line">    PersistentPreRun <span class="function"><span class="keyword">func</span><span class="params">(cmd *Command, args []<span class="keyword">string</span>)</span></span></span><br><span class="line"><span class="function">    <span class="title">PersistentPreRunE</span> <span class="title">func</span><span class="params">(cmd *Command, args []<span class="keyword">string</span>)</span> <span class="title">error</span></span></span><br><span class="line"><span class="function">    <span class="title">PreRun</span> <span class="title">func</span><span class="params">(cmd *Command, args []<span class="keyword">string</span>)</span></span></span><br><span class="line"><span class="function">    <span class="title">PreRunE</span> <span class="title">func</span><span class="params">(cmd *Command, args []<span class="keyword">string</span>)</span> <span class="title">error</span></span></span><br><span class="line"><span class="function">    <span class="title">Run</span> <span class="title">func</span><span class="params">(cmd *Command, args []<span class="keyword">string</span>)</span> // 命令的具体实现逻辑，大部分的命令只需要实现该参数</span></span><br><span class="line"><span class="function">    <span class="title">RunE</span> <span class="title">func</span><span class="params">(cmd *Command, args []<span class="keyword">string</span>)</span> <span class="title">error</span></span></span><br><span class="line"><span class="function">    <span class="title">PostRun</span> <span class="title">func</span><span class="params">(cmd *Command, args []<span class="keyword">string</span>)</span></span></span><br><span class="line"><span class="function">    <span class="title">PostRunE</span> <span class="title">func</span><span class="params">(cmd *Command, args []<span class="keyword">string</span>)</span> <span class="title">error</span></span></span><br><span class="line"><span class="function">    <span class="title">PersistentPostRun</span> <span class="title">func</span><span class="params">(cmd *Command, args []<span class="keyword">string</span>)</span></span></span><br><span class="line"><span class="function">    <span class="title">PersistentPostRunE</span> <span class="title">func</span><span class="params">(cmd *Command, args []<span class="keyword">string</span>)</span> <span class="title">error</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="Flag的使用"><a href="#Flag的使用" class="headerlink" title="Flag的使用"></a>Flag的使用</h2><ul>
<li>Persistent Flag: 全局Flag，对当前命令及其子命令皆可用</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rootCmd.PersistentFlags().BoolVarP(&amp;Verbose, <span class="string">"verbose"</span>, <span class="string">"v"</span>, <span class="literal">false</span>, <span class="string">"verbose output"</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>Local Flag: 局部Flag，只对当前命令可用</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rootCmd.Flags().StringVarP(&amp;Source, <span class="string">"source"</span>, <span class="string">"s"</span>, <span class="string">""</span>, <span class="string">"Source directory to read from"</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>Flag与Config绑定:</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rootCmd.PersistentFlags().StringVar(&amp;author, <span class="string">"author"</span>, <span class="string">"YOUR NAME"</span>, <span class="string">"Author name for copyright attribution"</span>)</span><br><span class="line">viper.BindPFlag(<span class="string">"author"</span>, RootCmd.PersistentFlags().Lookup(<span class="string">"author"</span>))</span><br></pre></td></tr></table></figure>
<ul>
<li>必填的Flag</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rootCmd.Flags().StringVarP(&amp;Region, <span class="string">"region"</span>, <span class="string">"r"</span>, <span class="string">""</span>, <span class="string">"AWS region (required)"</span>)</span><br><span class="line">rootCmd.MarkFlagRequired(<span class="string">"region"</span>)</span><br></pre></td></tr></table></figure>
<h2 id="Args的校验"><a href="#Args的校验" class="headerlink" title="Args的校验"></a>Args的校验</h2><ul>
<li>内置校验规则</li>
</ul>
<p>NoArgs: 如果包含任何Arg，命令报错<br>ArbitraryArgs: 命令接受任何Arg<br>OnlyValidArgs: 如果有Arg不在ValidArgs中，命令报错<br>MinimumArgs(init): 如果Arg数目少于N个后，命令报错<br>MaximumArgs(init): 如果Arg数目多余N个后，命令报错<br>ExactArgs(init): 如果Arg数目不是N个话，命令报错<br>RangeArgs(min, max): 如果Arg数目不在范围(min, max)中，命令报错</p>
<ul>
<li>自定义校验规则</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> cmd = &amp;cobra.Command&#123;</span><br><span class="line">    Short: <span class="string">"hello"</span>,</span><br><span class="line">    Args: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(args) &lt; <span class="number">1</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> errors.New(<span class="string">"requires at least one arg"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> myapp.IsValidColor(args[<span class="number">0</span>]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> fmt.Errorf(<span class="string">"invalid color specified: %s"</span>, args[<span class="number">0</span>])</span><br><span class="line">    &#125;,</span><br><span class="line">    Run: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">"Hello, World!"</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="自定义Help和Usage"><a href="#自定义Help和Usage" class="headerlink" title="自定义Help和Usage"></a>自定义Help和Usage</h2><ul>
<li>Help</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cmd.SetHelpCommand(cmd *Command)</span><br><span class="line">cmd.SetHelpFunc(f <span class="function"><span class="keyword">func</span><span class="params">(*Command, []<span class="keyword">string</span>)</span>)</span></span><br><span class="line"><span class="function"><span class="title">cmd</span>.<span class="title">SetHelpTemplate</span><span class="params">(s <span class="keyword">string</span>)</span></span></span><br></pre></td></tr></table></figure>
<ul>
<li>Usage</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cmd.SetUsageFunc(f <span class="function"><span class="keyword">func</span><span class="params">(*Command)</span> <span class="title">error</span>)</span></span><br><span class="line"><span class="function"><span class="title">cmd</span>.<span class="title">SetUsageTemplate</span><span class="params">(s <span class="keyword">string</span>)</span></span></span><br></pre></td></tr></table></figure>
<h2 id="生成帮助文档"><a href="#生成帮助文档" class="headerlink" title="生成帮助文档"></a>生成帮助文档</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"log"</span></span><br><span class="line"></span><br><span class="line">    <span class="string">"github.com/spf13/cobra"</span></span><br><span class="line">    <span class="string">"github.com/spf13/cobra/doc"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    cmd := &amp;cobra.Command&#123;</span><br><span class="line">        Use:   <span class="string">"test"</span>,</span><br><span class="line">        Short: <span class="string">"my test program"</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    err := doc.GenMarkdownTree(cmd, <span class="string">"/tmp"</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatal(err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://github.com/spf13/cobra" target="_blank" rel="noopener">corba</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Yihang</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">76</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">20</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">132</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Yihang</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"comment"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  


















  





  

  

  

  
  

  

  

  

</body>
</html>
