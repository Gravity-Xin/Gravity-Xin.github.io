<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=5.1.4">


  <link rel="mask-icon" href="/images/favicon.ico?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="Yihang&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/page/5/index.html">
<meta property="og:site_name" content="Yihang&#39;s Blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Yihang&#39;s Blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/5/">





  <title>Yihang's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Yihang's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/25/Elasticsearch入门/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yihang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yihang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/25/Elasticsearch入门/" itemprop="url">Elasticsearch入门</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-25T17:35:48+08:00">
                2019-01-25
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/系统架构/" itemprop="url" rel="index">
                    <span itemprop="name">系统架构</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/25/Elasticsearch入门/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/01/25/Elasticsearch入门/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>一个基于lucene的分布式多用户的存储和全文搜索引擎，提供Restful接口</p>
<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><ul>
<li><p>Index: 索引，类似于mysql中的database</p>
</li>
<li><p>Type: 类型，类似于mysql中的table</p>
</li>
<li><p>Document: JSON文档，类似于mysql中的row</p>
<ul>
<li>包含多个Field</li>
</ul>
</li>
<li><p>Mapping: JSON文档的schema，类似于mysql中的table schema</p>
</li>
<li><p>QueryDSL: 查询语句，类似于mysql中的sql语句</p>
</li>
<li><p>GET/PUT/POST/DELETE: Restful接口，实现文档的增删改查</p>
</li>
</ul>
<h2 id="基本功能"><a href="#基本功能" class="headerlink" title="基本功能"></a>基本功能</h2><ul>
<li><p>倒排索引</p>
<ul>
<li>对所有文档中的内容进行分词，得到单词列表<ul>
<li>Elasticsearch会使用标准化规则来处理单词中的大小写、单复数、同义词等问题，提高查询的命中率</li>
</ul>
</li>
<li>为每一个单词，赋予唯一的ID</li>
<li>建立文档中的单词ID与文档ID的关系</li>
<li>还可以记录每一个单词在文档中出现的次数称为单词频率信息、每一个单词在文档中出现的位置等</li>
<li>这样便通过分词获取到相关的文档，还可以通过单词频率信息确定单词与文档的相似度以进行排序</li>
</ul>
</li>
<li><p>分词器: 从一串文本中切分出一个一个的词条，同时对每一个词条进行标准化处理</p>
<ul>
<li>处理过程<ul>
<li>character filter: 分词前的预处理，如过滤HTML标签、特殊符号转换等</li>
<li>tokenizer: 分词操作</li>
<li>token filter: 标准化操作</li>
</ul>
</li>
<li>内置分词器<ul>
<li>standard: 默认分词器，将词汇单元转换为小写形式，去除停用词和标点符号，支持中文的单字切分</li>
<li>simple: 使用非字母字符来分割文本信息，将词汇单元统一为小写形式，去除数字类型的字符</li>
<li>whitespace: 仅去除空格，不支持中文</li>
<li>language: 特定语言的分词器，不支持中文</li>
</ul>
</li>
<li>中文分词器: <a href="https://github.com/medcl/elasticsearch-analysis-ik/" target="_blank" rel="noopener">ik</a></li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/24/Golang-内存对齐/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yihang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yihang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/24/Golang-内存对齐/" itemprop="url">Golang-内存对齐</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-24T17:35:23+08:00">
                2019-01-24
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程技术/" itemprop="url" rel="index">
                    <span itemprop="name">编程技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/24/Golang-内存对齐/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/01/24/Golang-内存对齐/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>与C++一样，在Golang中计算某个结构体占用的内存大小时，需要考虑到内存对齐的影响</p>
<p>在Golang中可以</p>
<ul>
<li>使用<code>unsafe.Sizeof()</code>获取某个数据类型占用的内存字节大小</li>
<li>使用<code>unsafe.Alignof()</code>获取某个数据类型的对齐系数</li>
<li>使用<code>unsafe.Offsetof()</code>获取某个结构体的成员变量相对于结构体起始地址的偏移量</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MyStruct <span class="keyword">struct</span>&#123;</span><br><span class="line">    a <span class="keyword">bool</span> <span class="comment">// 1 Byte</span></span><br><span class="line">    b <span class="keyword">int32</span> <span class="comment">// 4 Byte</span></span><br><span class="line">    c <span class="keyword">int8</span>  <span class="comment">// 1 Byte</span></span><br><span class="line">    d <span class="keyword">int64</span> <span class="comment">// 8 Byte</span></span><br><span class="line">    e <span class="keyword">byte</span>  <span class="comment">// 1 Byte</span></span><br><span class="line">    f <span class="keyword">float64</span> <span class="comment">// 8 Byte</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到MyStruct中所有字段加起来占用的内存大小为1+4+1+8+1+8=23个字节<br>但是获取到的MyStruct对象占用的内存却是40个字节，原因便是因为需要进行内存对齐</p>
<p>内存对齐产生的原因: 内存可以看做是字节数组，但是实际上CPU并不会一个一个字节的读取和写入内存，而是一块一块的读取，块的大小我们称为<code>对齐系数</code></p>
<p>结构体的对齐规则:</p>
<ul>
<li>默认对齐系数</li>
</ul>
<p>一般来讲，常用平台的默认系统系数为32位-&gt;4, 64位-&gt;8<br>可以使用预编译命令<code>#pragma pack(n)</code>来改变编译器的默认对齐系数</p>
<ul>
<li>结构体成员对齐</li>
</ul>
<p>结构体中每一个成员的都有对齐系数<br>第一个成员变量的偏移量为0，往后的每一个成员的对齐值必须为 min(默认对齐系数, 当期成员变量的内存字节长度)<br>每一个成员的偏移量必须为其对齐值的整数倍</p>
<ul>
<li>结构体整体对齐</li>
</ul>
<p>整个结构体本身也需要做字节对齐<br>结构体的对齐值必须为 min(默认对齐系数，结构体中成员变量中的最大对齐值)<br>偏移量为结构体对齐值的整数倍</p>
<p>因此，如果结构体中定义的字段顺序不同，那么结构体本身占用的内存大小也会不同，比如下面的结构，MyStruct对象占用的内存只有24个字节</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> MyStruct <span class="keyword">struct</span> &#123;</span><br><span class="line">    a <span class="keyword">bool</span>    <span class="comment">// 1 Byte</span></span><br><span class="line">    e <span class="keyword">byte</span>    <span class="comment">// 1 Byte</span></span><br><span class="line">    c <span class="keyword">int8</span>    <span class="comment">// 1 Byte</span></span><br><span class="line">    b <span class="keyword">int32</span>   <span class="comment">// 4 Byte</span></span><br><span class="line">    d <span class="keyword">int64</span>   <span class="comment">// 8 Byte</span></span><br><span class="line">    f <span class="keyword">float64</span> <span class="comment">// 8 Byte</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/23/Git-基本操作/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yihang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yihang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/23/Git-基本操作/" itemprop="url">Git-基本操作</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-23T14:05:31+08:00">
                2019-01-23
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程技术/" itemprop="url" rel="index">
                    <span itemprop="name">编程技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/23/Git-基本操作/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/01/23/Git-基本操作/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Git是流行的分布式版本控制系统。</p>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 设置全局的用户名和邮箱，在每次提交中将会使用该配置</span><br><span class="line">git config --global user.name "yihang.xin"</span><br><span class="line">git config --global user.email "xyh_nju@163.com"</span><br></pre></td></tr></table></figure>
<h2 id="初始化版本库"><a href="#初始化版本库" class="headerlink" title="初始化版本库"></a>初始化版本库</h2><p>Repository，成为代码仓库或代码版本库</p>
<ul>
<li>创建新的Repository</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir myRepo</span><br><span class="line">cd myRepo</span><br><span class="line"><span class="meta">#</span> 进行版本库初始化，生成.git文件夹，用于存放git相关信息</span><br><span class="line">git init</span><br></pre></td></tr></table></figure>
<ul>
<li>克隆远程Repository到本地</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone git@github.com:userName/projectName.git</span><br></pre></td></tr></table></figure>
<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><ul>
<li><p>工作区(Working Directory): 当前的工作目录</p>
</li>
<li><p>暂存区(Stage): 保存尚未提交到本地版本库中的修改</p>
</li>
<li><p>本地版本库(Repository)</p>
<ul>
<li>对于工作区中.git隐藏目录</li>
<li>其中包含了各个分支，各个分支最新提交(HEAD)等信息</li>
<li>文件的修改必须先添加到暂存区，然后才可以提交到本地版本库</li>
</ul>
</li>
</ul>
<p><img src="/images/git之本地仓库.png" alt="Git本地仓库"></p>
<ul>
<li>远程版本库<ul>
<li>可以克隆远程版本库</li>
<li>可以从远程版本库拉取更新或将本地更新推送到远程版本库</li>
</ul>
</li>
</ul>
<p><img src="/images/git之远程仓库.png" alt="Git远程仓库"></p>
<p>GitHub是免费的Git服务器，可以将个人仓库放在上面</p>
<p><img src="/images/git之GitHub使用流程.png" alt="GitHub使用流程"></p>
<h2 id="文件状态操作"><a href="#文件状态操作" class="headerlink" title="文件状态操作"></a>文件状态操作</h2><p><img src="/images/git之本地仓库文件状态流转.png" alt="Git文件状态流转"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 查看版本库状态</span><br><span class="line">git status</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 将文件添加到暂存区，在.git目录中建立索引</span><br><span class="line">git add file.go</span><br><span class="line"><span class="meta">#</span> 将文件中尚未提交到暂存区的的修改撤销，恢复到和暂存区相同的状态</span><br><span class="line">git checkout file.go</span><br><span class="line"><span class="meta">#</span> 将文件中已经提交到暂存区的修改进行撤销，将修改放回到工作区</span><br><span class="line">git reset HEAD file.go</span><br><span class="line"><span class="meta">#</span> 在git中，删除文件也是一种修改</span><br><span class="line">git rm file.go</span><br><span class="line"><span class="meta">#</span> 将文件的修改提交到本地仓库的分支</span><br><span class="line">git commit -m "commit message"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 查看提交的历史记录</span><br><span class="line"><span class="meta">#</span> commit: 提交的ID</span><br><span class="line"><span class="meta">#</span> 使用HEAD表示当前分支最新的版本，也就是最新的提交ID</span><br><span class="line">git log</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 在本地仓库的当前分支上进行版本回退，可以回退到HEAD之前或之后的任意提交</span><br><span class="line">git reset --hard commitID</span><br><span class="line"><span class="meta">#</span> 在本地仓库进行版本回退后，如果希望进行恢复，那么需要知道HEAD后一次的commitID</span><br><span class="line"><span class="meta">#</span> 查看当前分支所有的commitID</span><br><span class="line">git reflog</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 为本地仓库添加远程仓库，命名为origin</span><br><span class="line">git remote add origin git@github.com:userName/projectName.git</span><br><span class="line"><span class="meta">#</span> 查看远程仓库信息</span><br><span class="line">git remote -v</span><br><span class="line"><span class="meta">#</span> 与远程仓库分支建立关联并将文件提交到远程仓库的分支</span><br><span class="line">git push --set-upstream origin master</span><br></pre></td></tr></table></figure>
<h2 id="分支管理"><a href="#分支管理" class="headerlink" title="分支管理"></a>分支管理</h2><p>保证多项任务的同时进行，如同时开发多功能，或一边开发功能一边修改bug</p>
<ul>
<li>分支创建，修改，合并的过程</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 基于当前master分支，创建dev分支</span><br><span class="line">git branch dev</span><br><span class="line"><span class="meta">#</span> 将当前工作区切换到dev分支</span><br><span class="line">git checkout dev</span><br><span class="line"><span class="meta">#</span> 查看当前工作的分支</span><br><span class="line">git branch</span><br><span class="line"><span class="meta">#</span> 在dev分支上进行修改并提交</span><br><span class="line">git commit -a -m "first commit on branch dev"</span><br><span class="line"><span class="meta">#</span> 切换到master分支</span><br><span class="line">git checkout master</span><br><span class="line"><span class="meta">#</span> 将dev分支的修改merge到master分支上，此时master分支和dev分支对齐</span><br><span class="line">git merge dev</span><br><span class="line"><span class="meta">#</span> 将修改推送到远程仓库</span><br><span class="line">git push</span><br><span class="line"><span class="meta">#</span> 删除不再使用的dev分支</span><br><span class="line">git branch -d dev</span><br></pre></td></tr></table></figure>
<ul>
<li>合并分支时手动解决冲突<ul>
<li>在执行<code>git merge</code>时，有可能出现当前分支的修改与被合并的分支的修改之间出现冲突的情况</li>
<li>此时需要在本地手动修改发生冲突的文件内容，然后再进行一次提交</li>
</ul>
</li>
</ul>
<p>解决冲突后的历史记录:<img src="/images/git之解决冲突.png" alt="解决冲突后的历史记录"></p>
<ul>
<li>合并分支时禁用快进模式(Fast-forward)<ul>
<li>Git在进行合并时，默认会尝试使用快进模式，即只移动分支的HEAD指针进行合并</li>
<li>此时生成的提交记录是线性的，但是当被合并的分支被删除之后，在提交记录中会丢失此次合并的信息</li>
<li>可以在执行<code>git merge</code>时使用<code>--no-ff</code>模式，此时Git会在合并时生成一个新的commit</li>
</ul>
</li>
</ul>
<p>快进合并后的历史记录:<img src="/images/git之Fast-forward合并模式.png" alt="快进合并后的历史记录"></p>
<p>非快进合并后的历史记录:<img src="/images/git之非Fast-forward合并模式.png" alt="非快进合并后的历史记录"></p>
<ul>
<li>临时保存工作区的修改</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 当前在feature1分支，保存工作区的修改</span><br><span class="line">git stash</span><br><span class="line"><span class="meta">#</span> 查看stash中的内容</span><br><span class="line">git stash list</span><br><span class="line"><span class="meta">#</span> 切换到另一个分支</span><br><span class="line">git checkout feature2</span><br><span class="line"><span class="meta">#</span> 修改并提交</span><br><span class="line">git commit -a -m "fix bug"</span><br><span class="line"><span class="meta">#</span> 切换到feature1分支</span><br><span class="line">git checkout feature1</span><br><span class="line"><span class="meta">#</span> 恢复工作区，继续进行修改</span><br><span class="line">git stash pop</span><br></pre></td></tr></table></figure>
<ul>
<li>分支合并与分支变基<ul>
<li>在进行分支合并时，可以使用<code>git merge</code>操作，但是有可能因为出现冲突或使用非快进的模式导致出现一个新的commit，从而使得提交记录是非线性的</li>
<li>可以使用<code>git rebase</code>进行变基操作，可以得到线性的提交记录</li>
<li>变基操作的原理<ul>
<li>找出分支feature1和master中最后相同的一次提交commitA</li>
<li>将feature1分支中commitA后的下一次提交移动到master的最后一次提交之后</li>
<li>此时，feature1分支中的历史记录变为线性</li>
</ul>
</li>
<li>将feature1分支合并到master分支上<ul>
<li>切换到master分支</li>
<li>执行<code>git merge feature1</code></li>
</ul>
</li>
<li>将feature1分支变基到master分支上<ul>
<li>切换到feature1分支</li>
<li>执行<code>git rebase master</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 此时处于feature1分支，对其进行变基</span><br><span class="line">git rebase master</span><br><span class="line"><span class="meta">#</span> 切换到master分支</span><br><span class="line">git checkout master</span><br><span class="line"><span class="meta">#</span> 对master分支执行变基，此时feature1上面的修改全部合并到master分支中</span><br><span class="line">git rebase feature1</span><br></pre></td></tr></table></figure>
<h2 id="标签管理"><a href="#标签管理" class="headerlink" title="标签管理"></a>标签管理</h2><p>标签(Tag)可以看做是执行某次commit的指针，保存了某次commit对应的版本快照，只不过标签不能够在commit上进行移动</p>
<p>可以使用标签进行版本管理，在发布版本时给代码库打一个标签，从而方便查找历史版本的代码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 创建标签</span><br><span class="line">git tag v1.0</span><br><span class="line"><span class="meta">#</span> 查看存在的标签列表</span><br><span class="line">git tag</span><br><span class="line"><span class="meta">#</span> 查看标签信息</span><br><span class="line">git show v1.0</span><br><span class="line"><span class="meta">#</span> 创建的标签默认在本地，可以将标签推送至远程仓库</span><br><span class="line">git push origin v1.0</span><br><span class="line"><span class="meta">#</span> 将本地所有的标签推送到远程仓库</span><br><span class="line">git push --tags</span><br><span class="line"><span class="meta">#</span> 删除标签</span><br><span class="line">git tag -d v1.0</span><br><span class="line"><span class="meta">#</span> 删除远程仓库的标签</span><br><span class="line">git push origin :refs/tags/v1.0</span><br></pre></td></tr></table></figure>
<h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><ul>
<li>使用<code>.gitignore</code>将特定文件从仓库中忽略</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/22/Golang-slice/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yihang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yihang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/22/Golang-slice/" itemprop="url">Golang-slice</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-22T17:25:33+08:00">
                2019-01-22
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程技术/" itemprop="url" rel="index">
                    <span itemprop="name">编程技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/22/Golang-slice/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/01/22/Golang-slice/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>golang中的slice(切片)是基于array(数组)上的内置类型，可以看做是能够自动扩容的动态数组<br>与内置的map, chan一样，都是引用类型</p>
<h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2><ul>
<li>array<ul>
<li>需要指定数组元素类型和数组长度</li>
<li>底层为连续的内存空间，使用下标作为索引来进行存取</li>
<li>声明后，数组元素为零值</li>
<li>数组长度也是数组类型的一部分，因此<code>[3]int</code>和<code>[4]int</code>不是同一个类型</li>
</ul>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    nums := [<span class="number">3</span>]<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">    nums[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">    n := nums[<span class="number">0</span>]</span><br><span class="line">    n = <span class="number">2</span></span><br><span class="line">    fmt.Printf(<span class="string">"nums: %v\n"</span>, nums)</span><br><span class="line">    fmt.Printf(<span class="string">"n: %d\n"</span>, n)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>slice<ul>
<li>底层为数组</li>
<li>不需要指定切片的长度</li>
<li>使用<code>var []T</code>, <code>[]T{}</code>或 <code>make([]T, len, cap)</code>来创建</li>
<li>使用<code>append</code>来增加元素，可以自动扩容</li>
<li>使用<code>copy</code>来进行切片的拷贝，返回被复制的元素数</li>
<li>使用<code>[start:end]</code>来进行切片的resize操作</li>
</ul>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    nums := [<span class="number">3</span>]<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">    nums[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">    dnums := nums[:]</span><br><span class="line">    fmt.Printf(<span class="string">"dnums: %v"</span>, dnums)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h2><p><img src="/images/Golang-slice的实现.png" alt="slice"></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> slice <span class="keyword">struct</span> &#123;</span><br><span class="line">    array unsafe.Pointer <span class="comment">//所引用的底层数据的指针</span></span><br><span class="line">    <span class="built_in">len</span>   <span class="keyword">int</span>  <span class="comment">// 当前切片的元素个数</span></span><br><span class="line">    <span class="built_in">cap</span>   <span class="keyword">int</span>  <span class="comment">// 当前切片的容量(底层数组的长度)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>扩容带来的问题</p>
<ul>
<li>未扩容时，对slice的修改会直接影响到底层的array</li>
<li>发送扩容时，slice不再引用底层数据，对slice的修改不再影响到底层的array</li>
</ul>
<p>empty slice和nil slice</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">emptyNums := []<span class="keyword">int</span>&#123;&#125; <span class="comment">// 切片中的array指向一个空的数组</span></span><br><span class="line"><span class="keyword">var</span> nilNums []<span class="keyword">int</span> <span class="comment">// 切片中的array为nil，不指向任何数组</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/22/Golang-corba/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yihang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yihang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/22/Golang-corba/" itemprop="url">Golang-corba</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-22T11:18:51+08:00">
                2019-01-22
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程技术/" itemprop="url" rel="index">
                    <span itemprop="name">编程技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/22/Golang-corba/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/01/22/Golang-corba/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>使用corba库可以方便的编写cli程序，其中Docker和Kubernetes的客户端程序便是基于corba库进行开发的。</p>
<p>corba库的特点:</p>
<ul>
<li>支持子命令，如<code>app fetch</code>, <code>app push</code>等</li>
<li>兼容Posix标准的命令行模式</li>
<li>支持子命令的嵌套</li>
<li>支持全局、局部和串联的<code>Flag</code></li>
<li>使用<code>corba create appname</code>和<code>corba add cmdname</code>可以方便的创建应用程序和增加命令</li>
<li>命令输入错误时的智能提示</li>
<li>自动生成命令和Flag的帮助信息</li>
<li>默认支持<code>-h</code>和<code>--help</code>，输出帮助信息</li>
<li>Bash下命令的自动补全</li>
<li>自动生成应用的man手册信息</li>
<li>支持命令别名</li>
<li>支持自定义<code>Help</code>、<code>Usage</code>等信息</li>
</ul>
<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><ul>
<li><code>Command</code>: 命令，代表执行的动作</li>
<li><code>Arg</code>: 命令对象，代表动作对应的对象</li>
<li><code>Flag</code>: 命令参数</li>
</ul>
<p>因此，cli程序的使用方式为<code>AppName Command Arg --Flag</code>，其中<code>Command</code>还有可能包含子命令</p>
<h2 id="项目初始化"><a href="#项目初始化" class="headerlink" title="项目初始化"></a>项目初始化</h2><ul>
<li>安装:<code>go get -u github.com/spf13/cobra/cobra</code></li>
<li><p>导入: <code>import &quot;github.com/spf13/cobra&quot;</code></p>
</li>
<li><p>项目结构:</p>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">appName/</span><br><span class="line">    cmd/</span><br><span class="line">        cmd1.<span class="keyword">go</span></span><br><span class="line">        cmd2.<span class="keyword">go</span></span><br><span class="line">    main.<span class="keyword">go</span></span><br></pre></td></tr></table></figure>
<ul>
<li>main.go: 初始化corba</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">"appName/cmd"</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cmd.Execute()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="使用corba命令自动生成代码"><a href="#使用corba命令自动生成代码" class="headerlink" title="使用corba命令自动生成代码"></a>使用corba命令自动生成代码</h3><ul>
<li><p>执行<code>corba init toolchain</code>: 在{GOPATH}/src/toolchain下生成应用代码</p>
</li>
<li><p>在{GOPATH}/src/toolchain下执行<code>corba add scenario</code>: 为应用程序增加命令scenario</p>
</li>
<li><p>在{GOPATH}/src/toolchain下执行<code>corba add create -p scenarioCmd</code>: 为scenario增加子命令create</p>
</li>
</ul>
<h3 id="手动编写代码"><a href="#手动编写代码" class="headerlink" title="手动编写代码"></a>手动编写代码</h3><ul>
<li><p>在{GOPATH}/src/toolchain下手动创建main.go文件，进行corba的初始化</p>
</li>
<li><p>在{GOPATH}/src/toolchain/cmd手动创建各个命令文件，对命令进行定义</p>
</li>
</ul>
<h2 id="Command对象"><a href="#Command对象" class="headerlink" title="Command对象"></a>Command对象</h2><p>命令对象是cli应用的核心，命令可能还会包括子命令</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Command <span class="keyword">struct</span> &#123;</span><br><span class="line">    Use <span class="keyword">string</span> <span class="comment">// 命令的名称</span></span><br><span class="line"></span><br><span class="line">    Aliases []<span class="keyword">string</span> <span class="comment">// 命令的别名列表</span></span><br><span class="line"></span><br><span class="line">    SuggestFor []<span class="keyword">string</span> <span class="comment">// 该命令可以被提议使用的名称列表</span></span><br><span class="line"></span><br><span class="line">    Short <span class="keyword">string</span> <span class="comment">// 命令的简短描述，在help信息中展示</span></span><br><span class="line"></span><br><span class="line">    Long <span class="keyword">string</span> <span class="comment">// 命令的详细描述，在'help &lt;this-command&gt;'中展示</span></span><br><span class="line"></span><br><span class="line">    Example <span class="keyword">string</span> <span class="comment">// 命令的使用例子</span></span><br><span class="line"></span><br><span class="line">    ValidArgs []<span class="keyword">string</span> <span class="comment">// 在Bash自动补全中的所有合法的Arg列表</span></span><br><span class="line"></span><br><span class="line">    Args PositionalArgs <span class="comment">// Arg参数校验规则函数</span></span><br><span class="line"></span><br><span class="line">    ArgAliases []<span class="keyword">string</span> <span class="comment">// Arg参数别名列表</span></span><br><span class="line"></span><br><span class="line">    BashCompletionFunction <span class="keyword">string</span> <span class="comment">// Bash自动补全时的字符串</span></span><br><span class="line"></span><br><span class="line">    Deprecated <span class="keyword">string</span> <span class="comment">// 使用已被弃用的命令时输出的字符串</span></span><br><span class="line"></span><br><span class="line">    Hidden <span class="keyword">bool</span> <span class="comment">// 命令是否隐藏，如果隐藏则不会输出给用户</span></span><br><span class="line"></span><br><span class="line">    Annotations <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span> <span class="comment">// 命令关联的KV对，用于标识命令或对命令进行分组</span></span><br><span class="line"></span><br><span class="line">    Version <span class="keyword">string</span> <span class="comment">// 命令的版本</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// *Run系列函数的执行顺序如下:</span></span><br><span class="line">    <span class="comment">//   * PersistentPreRun() 当前命令的子命令可以实现和运行</span></span><br><span class="line">    <span class="comment">//   * PreRun() 当前命令的子命令无法实现和运行</span></span><br><span class="line">    <span class="comment">//   * Run()</span></span><br><span class="line">    <span class="comment">//   * PostRun() 当前命令的子命令无法实现和运行</span></span><br><span class="line">    <span class="comment">//   * PersistentPostRun() 当前命令的子命令可以实现和运行</span></span><br><span class="line">    <span class="comment">// 所有函数的输入参数相同的Arg参数</span></span><br><span class="line">    PersistentPreRun <span class="function"><span class="keyword">func</span><span class="params">(cmd *Command, args []<span class="keyword">string</span>)</span></span></span><br><span class="line"><span class="function">    <span class="title">PersistentPreRunE</span> <span class="title">func</span><span class="params">(cmd *Command, args []<span class="keyword">string</span>)</span> <span class="title">error</span></span></span><br><span class="line"><span class="function">    <span class="title">PreRun</span> <span class="title">func</span><span class="params">(cmd *Command, args []<span class="keyword">string</span>)</span></span></span><br><span class="line"><span class="function">    <span class="title">PreRunE</span> <span class="title">func</span><span class="params">(cmd *Command, args []<span class="keyword">string</span>)</span> <span class="title">error</span></span></span><br><span class="line"><span class="function">    <span class="title">Run</span> <span class="title">func</span><span class="params">(cmd *Command, args []<span class="keyword">string</span>)</span> // 命令的具体实现逻辑，大部分的命令只需要实现该参数</span></span><br><span class="line"><span class="function">    <span class="title">RunE</span> <span class="title">func</span><span class="params">(cmd *Command, args []<span class="keyword">string</span>)</span> <span class="title">error</span></span></span><br><span class="line"><span class="function">    <span class="title">PostRun</span> <span class="title">func</span><span class="params">(cmd *Command, args []<span class="keyword">string</span>)</span></span></span><br><span class="line"><span class="function">    <span class="title">PostRunE</span> <span class="title">func</span><span class="params">(cmd *Command, args []<span class="keyword">string</span>)</span> <span class="title">error</span></span></span><br><span class="line"><span class="function">    <span class="title">PersistentPostRun</span> <span class="title">func</span><span class="params">(cmd *Command, args []<span class="keyword">string</span>)</span></span></span><br><span class="line"><span class="function">    <span class="title">PersistentPostRunE</span> <span class="title">func</span><span class="params">(cmd *Command, args []<span class="keyword">string</span>)</span> <span class="title">error</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="Flag的使用"><a href="#Flag的使用" class="headerlink" title="Flag的使用"></a>Flag的使用</h2><ul>
<li>Persistent Flag: 全局Flag，对当前命令及其子命令皆可用</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rootCmd.PersistentFlags().BoolVarP(&amp;Verbose, <span class="string">"verbose"</span>, <span class="string">"v"</span>, <span class="literal">false</span>, <span class="string">"verbose output"</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>Local Flag: 局部Flag，只对当前命令可用</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rootCmd.Flags().StringVarP(&amp;Source, <span class="string">"source"</span>, <span class="string">"s"</span>, <span class="string">""</span>, <span class="string">"Source directory to read from"</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>Flag与Config绑定:</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rootCmd.PersistentFlags().StringVar(&amp;author, <span class="string">"author"</span>, <span class="string">"YOUR NAME"</span>, <span class="string">"Author name for copyright attribution"</span>)</span><br><span class="line">viper.BindPFlag(<span class="string">"author"</span>, RootCmd.PersistentFlags().Lookup(<span class="string">"author"</span>))</span><br></pre></td></tr></table></figure>
<ul>
<li>必填的Flag</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rootCmd.Flags().StringVarP(&amp;Region, <span class="string">"region"</span>, <span class="string">"r"</span>, <span class="string">""</span>, <span class="string">"AWS region (required)"</span>)</span><br><span class="line">rootCmd.MarkFlagRequired(<span class="string">"region"</span>)</span><br></pre></td></tr></table></figure>
<h2 id="Args的校验"><a href="#Args的校验" class="headerlink" title="Args的校验"></a>Args的校验</h2><ul>
<li>内置校验规则</li>
</ul>
<p>NoArgs: 如果包含任何Arg，命令报错<br>ArbitraryArgs: 命令接受任何Arg<br>OnlyValidArgs: 如果有Arg不在ValidArgs中，命令报错<br>MinimumArgs(init): 如果Arg数目少于N个后，命令报错<br>MaximumArgs(init): 如果Arg数目多余N个后，命令报错<br>ExactArgs(init): 如果Arg数目不是N个话，命令报错<br>RangeArgs(min, max): 如果Arg数目不在范围(min, max)中，命令报错</p>
<ul>
<li>自定义校验规则</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> cmd = &amp;cobra.Command&#123;</span><br><span class="line">    Short: <span class="string">"hello"</span>,</span><br><span class="line">    Args: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(args) &lt; <span class="number">1</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> errors.New(<span class="string">"requires at least one arg"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> myapp.IsValidColor(args[<span class="number">0</span>]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> fmt.Errorf(<span class="string">"invalid color specified: %s"</span>, args[<span class="number">0</span>])</span><br><span class="line">    &#125;,</span><br><span class="line">    Run: <span class="function"><span class="keyword">func</span><span class="params">(cmd *cobra.Command, args []<span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">"Hello, World!"</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="自定义Help和Usage"><a href="#自定义Help和Usage" class="headerlink" title="自定义Help和Usage"></a>自定义Help和Usage</h2><ul>
<li>Help</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cmd.SetHelpCommand(cmd *Command)</span><br><span class="line">cmd.SetHelpFunc(f <span class="function"><span class="keyword">func</span><span class="params">(*Command, []<span class="keyword">string</span>)</span>)</span></span><br><span class="line"><span class="function"><span class="title">cmd</span>.<span class="title">SetHelpTemplate</span><span class="params">(s <span class="keyword">string</span>)</span></span></span><br></pre></td></tr></table></figure>
<ul>
<li>Usage</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cmd.SetUsageFunc(f <span class="function"><span class="keyword">func</span><span class="params">(*Command)</span> <span class="title">error</span>)</span></span><br><span class="line"><span class="function"><span class="title">cmd</span>.<span class="title">SetUsageTemplate</span><span class="params">(s <span class="keyword">string</span>)</span></span></span><br></pre></td></tr></table></figure>
<h2 id="生成帮助文档"><a href="#生成帮助文档" class="headerlink" title="生成帮助文档"></a>生成帮助文档</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"log"</span></span><br><span class="line"></span><br><span class="line">    <span class="string">"github.com/spf13/cobra"</span></span><br><span class="line">    <span class="string">"github.com/spf13/cobra/doc"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    cmd := &amp;cobra.Command&#123;</span><br><span class="line">        Use:   <span class="string">"test"</span>,</span><br><span class="line">        Short: <span class="string">"my test program"</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    err := doc.GenMarkdownTree(cmd, <span class="string">"/tmp"</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatal(err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://github.com/spf13/cobra" target="_blank" rel="noopener">corba</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/18/Kubernetes安装部署/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yihang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yihang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/18/Kubernetes安装部署/" itemprop="url">Kubernetes安装部署</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-18T17:15:06+08:00">
                2019-01-18
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/系统架构/" itemprop="url" rel="index">
                    <span itemprop="name">系统架构</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/18/Kubernetes安装部署/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/01/18/Kubernetes安装部署/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>K8S的安装方式:</p>
<ul>
<li>使用<code>Minikube</code>安装K8S单机环境</li>
<li>使用二进制安装<ul>
<li>将Master节点上的组件(<code>API Server</code>、<code>Controller Manager</code>、<code>Scheduler</code>、<code>ETCD</code>等)直接以二进制的形式安装在主机上</li>
<li>Node节点上的组件(<code>Kubelet</code>、<code>Docker</code>、<code>Kube-Proxy</code>等)直接以二进制的形式安装在主机上</li>
<li>这是一种传统方式，所有K8S组件都是系统级别的守护进</li>
<li>该方式比较麻烦，因为需要手动去安装和配置各个组件，比如配置节点间安全通信的证书</li>
<li>在该方式下，如果某些K8S组件出现故障，需要手动去进行管理和维护，因此不推荐该方式<br><a href="https://github.com/opsnull/follow-me-install-kubernetes-cluster" target="_blank" rel="noopener">参考</a></li>
</ul>
</li>
<li>使用<code>Kubeadm</code>自动化工具安装<ul>
<li>内部调用<code>Kubectl</code>等命令</li>
<li>在所有主机上安装<code>Docker</code>、<code>Kubelet</code>和<code>Kubeadm</code>组件，提供主机上运行容器和Pod的基础环境</li>
<li>将某台主机使用<code>Kubeadm init</code>初始化为Master节点</li>
<li>在其他主机上使用<code>Kubeadm join</code>来进入到K8S集群中，作为Node节点</li>
<li>在Master节点上以Pod的形式在容器中运行组件(<code>API Server</code>、<code>Controller Manager</code>、<code>Scheduler</code>、<code>ETCD</code>等)</li>
<li>在Node节点上以Pod的形式在容器中运行组件(<code>Kube-Proxy</code>等)</li>
<li>K8S所有组件以Pod的方式来运行，这些Pod为静态Pod，由<code>Kubelet</code>进行管理，仅存于特定Node上，不能通过API Server进行管理</li>
<li>在所有主机上以Pod的方式来运行<code>Flannel</code>，为Pod提供IP地址分配的功能，该Pod由K8S来进行管理<br><a href="https://github.com/kubernetes/kubeadm/blob/master/docs/design/design_v1.10.md" target="_blank" rel="noopener">参考</a></li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/18/Docker的Linux原理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yihang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yihang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/18/Docker的Linux原理/" itemprop="url">Docker的Linux原理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-18T14:07:53+08:00">
                2019-01-18
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/系统架构/" itemprop="url" rel="index">
                    <span itemprop="name">系统架构</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/18/Docker的Linux原理/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/01/18/Docker的Linux原理/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="使用namespace实现资源隔离"><a href="#使用namespace实现资源隔离" class="headerlink" title="使用namespace实现资源隔离"></a>使用namespace实现资源隔离</h2><ul>
<li><p>UTS: 主机与域名隔离，使用独立的主机名称，从而能够网络中标识自己</p>
</li>
<li><p>IPC: 进程间通信隔离，如信号量、消息队列、共享内存等</p>
</li>
<li><p>PID: 进程隔离，与宿主机中的进程ID隔离</p>
</li>
<li><p>Network: 网络设备、网络栈、端口等隔离</p>
</li>
<li><p>Mount: 文件系统隔离，使用<code>chroot</code>来切换根目录的挂载点</p>
</li>
<li><p>User: 用户，用户组和权限的隔离</p>
</li>
</ul>
<h2 id="使用cgroups实现资源限制"><a href="#使用cgroups实现资源限制" class="headerlink" title="使用cgroups实现资源限制"></a>使用cgroups实现资源限制</h2><ul>
<li><p>CPU</p>
</li>
<li><p>Memory</p>
</li>
<li><p>Disk I/O</p>
</li>
<li><p>Network I/O</p>
</li>
</ul>
<h2 id="使用union-filesystem实现镜像"><a href="#使用union-filesystem实现镜像" class="headerlink" title="使用union-filesystem实现镜像"></a>使用union-filesystem实现镜像</h2><ul>
<li><p>基于copy-on-write，写时复制</p>
</li>
<li><p>多个layer，最上层为一个可写的层</p>
</li>
<li><p>所有对容器的修改其实都是对最上层的修改</p>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/17/Kubernetes入门/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yihang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yihang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/17/Kubernetes入门/" itemprop="url">Kubernetes入门</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-17T16:31:32+08:00">
                2019-01-17
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/系统架构/" itemprop="url" rel="index">
                    <span itemprop="name">系统架构</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/17/Kubernetes入门/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/01/17/Kubernetes入门/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>当前主流的容器编排技术包括</p>
<ul>
<li><code>docker compose</code>: Docker官方的单机版本的容器编排工具</li>
<li><code>docker swarm</code>: Docker官方的多机版本的容器编排工具</li>
<li><code>mesos + marathon</code>: Apache提供的集群资源管理和容器编排工具</li>
<li><code>kubernetes</code>: Google提供的容器编排工具，事实上已经成为容器编排的标准工具</li>
</ul>
<h2 id="主要功能"><a href="#主要功能" class="headerlink" title="主要功能"></a>主要功能</h2><ul>
<li>基于容器的应用的自动部署、滚动升级、自动修复和版本回滚</li>
<li>应用配置的管理</li>
<li>服务的自动伸缩和水平扩展</li>
<li>负载均衡和服务发现</li>
<li>跨机器和跨地区的集群调度</li>
<li>无状态和有状态服务</li>
<li>广泛的数据卷支持和管理</li>
<li>插件机制保证可扩展性</li>
</ul>
<h2 id="系统架构"><a href="#系统架构" class="headerlink" title="系统架构"></a>系统架构</h2><p>Master-Slave(Node)结构</p>
<p><img src="/images/Kubernetes之系统架构.png" alt="kubernetes architecture"></p>
<ul>
<li><p><code>Kubectl</code>: 用户的命令行交互工具</p>
</li>
<li><p>K8S Control Plane(Master): 管理整个集群</p>
<ul>
<li>各个组件可以以分布式的形式在多台机器上运行</li>
<li>为保证高可用，推荐部署3个Master节点</li>
<li>主要组件包括:<ul>
<li><code>API Server</code>: 用户API入口<ul>
<li>将K8S API以<code>JSON over HTTP</code>的形式暴露给用户</li>
<li>用户可以通过kubectl发起请求，对集群中的Pod在Node上进行调度</li>
<li>请求处理的结果最终保存到ETCD中</li>
</ul>
</li>
<li><code>Controller Manager</code>: 控制器管理器<ul>
<li>管理多个Pod控制器，一般一个Pod需要一个Pod控制器</li>
<li>常用的Pod控制器包括:<ul>
<li><code>ReplicationController</code>: 早期版本的副本控制器</li>
<li><code>ReplicaSet</code>: 副本集控制器，一般不直接使用</li>
<li><code>Deployment</code>: 声明式的无状态应用部署控制器，支持滚动升级和版本回滚<ul>
<li>支持HPA(HorizontalPodAutoscaling)，可以对应用进行自动伸缩</li>
</ul>
</li>
<li><code>DaemonSet</code>: 无状态应用，保证一个Node上运行一个Pod，对应系统级别的后台进程</li>
<li><code>StatefulSet</code>: 有状态应用</li>
<li><code>Job</code>: 一次性任务，即完成后便退出的应用</li>
<li><code>Cronjob</code>: 周期性任务，不需要持续运行的应用</li>
</ul>
</li>
<li>每个控制器分别负责监控集群中的某些状态，使之符合Object.status的要求</li>
<li>与API Server进行通信，实现资源(Pod, Service)的创建、更新和删除</li>
</ul>
</li>
<li><code>Scheduler</code>: 调度器<ul>
<li>将集群中所有的Node的资源看做是一个整体</li>
<li>监控各个Node上的资源使用情况</li>
<li>对资源进行调度，按照预定的策略将Pod调度到对应的Node上</li>
</ul>
</li>
<li><code>ETCD</code>: 集群状态存储<ul>
<li>轻量级的分布式一致性KV存储服务</li>
<li>API Server使用其提供的watch机制对资源状态进行监控</li>
<li>存储整个集群的状态信息</li>
</ul>
</li>
<li><code>AddONs</code>: 插件，也是以Pod+Service的形式运行<ul>
<li>DNS: 解析规则会根据集群状态的变化而自动改变</li>
<li>Dashboard: 集群管理页面</li>
<li>Heapster: 集群监控</li>
<li>IngressController: Ingress资源管理</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>K8S Node(Slave): Pod真正运行的机器</p>
<ul>
<li>带有容器的运行时，比如Docker</li>
<li>还包括以下组件<ul>
<li><code>Kubelet</code><ul>
<li>对容器、数据卷、网络等进行管理</li>
<li>监控容器运行状态和资源使用状态并上报到Master</li>
</ul>
</li>
<li><code>Container</code><ul>
<li>处于Pod的内部，包含了应用所需的依赖</li>
</ul>
</li>
<li><code>Kube-Proxy</code><ul>
<li>实现了网络代理、服务发现、负载均衡等功能</li>
<li>当Service对象发生变化后，自动在iptables中修改对应的规则，相当于为Service对象提供了一层抽象</li>
</ul>
</li>
<li><code>cAdvisor</code><ul>
<li>Kubelet使用cAdvisor进行容器资源使用情况的收集</li>
<li>对各个容器使用的系统资源(CPU,Memory,Network,File)进行收集</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><ul>
<li><p><code>Namespace</code>: 用于创建多个虚拟集群，对资源进行隔离</p>
<ul>
<li>命名空间的名称在系统中唯一</li>
<li>删除一个命名空间会自动删除属于该空间的资源</li>
<li>名称为default和kube-system为系统使用，不可以删除</li>
<li>大多数的资源都属于命名空间，如Pod, Service, Replica, Deployment等</li>
<li>低级别的资源如Node, PersistentVolume则不属于任何命名空间</li>
</ul>
</li>
<li><p><code>Pod</code>: 系统中可以进行调度的最小对象，可以包含一个或多个容器</p>
<ul>
<li>Pod在系统中会被分配一个唯一的IP地址</li>
<li>Pod中的多个容器共享网络、数据卷等 <strong>使用pause容器作为根容器，Pod中的其它容器共享pause容器的各类名称空间</strong></li>
<li>Pod内部的容器之间可以通过localhost进行访问 <strong>本质是Pod中的容器使用的是联盟式网络</strong></li>
<li>Pod是有生命周期的，可能会被集群启动、修改和删除</li>
<li>跨Pod的容器之间的访问可以通过Service对象来实现</li>
</ul>
</li>
<li><p><code>Service</code>: 一个或多个Pod组成，是Pod之上的概念</p>
<ul>
<li>通过Label Selector来筛选Pod，符合条件的Pod的IP和端口组成了一个EndPoints列表</li>
<li>每一个Service会被分配一个Cluster IP和DNS名称</li>
<li>外部用户和其他Service可以通过该Cluster IP或DNS名来访问服务，而不需要了解服务对应的Pod列表，可以将Service看做是对Pod的代理</li>
<li>Kube-Proxy将用户对Service的访问均衡负载到这些EndPoints上，从而实现了负载均衡和服务发现的功能  <strong>本质上是DNS解析和在iptables添加了DNAT数据转发规则</strong></li>
</ul>
</li>
<li><p><code>Volume</code>: 为Pod提供存储空间和文件共享</p>
</li>
</ul>
<p>管理<code>Object</code>的机制包括:</p>
<ul>
<li><code>Label</code>: 识别Object的标签<ul>
<li>key/value对<ul>
<li>key: 长度小于63字符，只能为数字、字母、下划线、_和.，且以字母开头</li>
<li>value: 长度小于63字符，可以为空，只能为数字、字母、下划线、_和.，且以字母或数字开头结尾</li>
</ul>
</li>
<li>使用<code>kubectl get --selector</code>命令可以通过指定的标签选择器过滤出符合条件的Object<ul>
<li>等式: app=nginx env!=production</li>
<li>集合: env in (production, test)</li>
<li>组合: app=nginx, env=test</li>
</ul>
</li>
<li>使用<code>kubectl label</code>命令更新对象的标签</li>
<li>许多资源如<code>ReplicaSet</code>、<code>Deployment</code>支持使用内嵌字段来定义它们的标签选择器，从而从集群中获取符合条件的资源<ul>
<li><code>matchLabels</code>: 直接给定标签的KV对</li>
<li><code>matchExpressions</code>: 基于给定的表达式来定义标签选择器</li>
</ul>
</li>
</ul>
</li>
<li><code>Annotation</code>: 对Object的描述<ul>
<li>key/value对，键值大小不受限制</li>
<li>记录Object的一些附属信息</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/16/Golang-https服务器/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yihang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yihang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/16/Golang-https服务器/" itemprop="url">Golang-https服务器</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-16T17:05:47+08:00">
                2019-01-16
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程技术/" itemprop="url" rel="index">
                    <span itemprop="name">编程技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/16/Golang-https服务器/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/01/16/Golang-https服务器/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="加密、签名和数字证书"><a href="#加密、签名和数字证书" class="headerlink" title="加密、签名和数字证书"></a>加密、签名和数字证书</h2><ul>
<li><p>对称加密: 加密和解密的密钥是相同的</p>
<ul>
<li>需要使用安全的渠道在通信双方首次通信时协商一个共同的密钥</li>
<li>密钥的数目多了之后比较难于管理</li>
<li>常见对称加密算法有: <code>DES</code></li>
</ul>
</li>
<li><p>非对称加密: 加密和解密的密钥是不同的，分为私钥和公钥。其中公钥是公开的，任何人都可以获取，而私钥是私有的。使用公钥加密的数据可以使用私钥来解密；使用私钥加密的数据可以使用公钥来解密</p>
<ul>
<li>通信A方将自己的公钥公开，得到该公钥的B方使用其对发送数据进行加密，A方收到数据后再使用自己的私钥进行解密</li>
<li>常见非对称加密算法有: <code>RSA</code></li>
</ul>
</li>
<li><p>签名: 在发送的数据之后增加一段内容，用于证明数据未被修改。一般是通过对数据进行一个Hash计算得到，是不可逆的。签名和要数据会被一起发送出去</p>
</li>
<li><p>数字证书: 确保数字证书里面的公钥确实是这个证书的所有者的，即用证书来确认对方的身份</p>
<ul>
<li>如果客户端需要对服务器进行验证，则需要服务器提供数字证书</li>
<li>如果服务器需要对客户端进行验证，则需要客户端提供数字证书</li>
<li>证书的主要内容<ul>
<li><code>Issuer</code>: 证书颁发机构</li>
<li><code>Valid From、Valid To</code>: 证书的有效期</li>
<li><code>Public Key</code>: 公钥</li>
<li><code>Subject</code>: 证书的所有者，一般为某人、某公司名称、某网站地址等</li>
</ul>
</li>
<li>由权威的第三方机构颁发</li>
</ul>
</li>
</ul>
<h2 id="TLS协议"><a href="#TLS协议" class="headerlink" title="TLS协议"></a>TLS协议</h2><p>https协议使用TLS(Transport Layer Security, 传输层安全协议)来保证通信的安全性和数据的完整性，该协议工作在TCP协议之上，可以看做是SSL协议的升级版</p>
<p>TLS基于X.509来进行认证，然后使用非对称加密算法来进行通信双方的身份认证，然后进行公钥的交换，并使用公钥对通信双方的数据进行加密</p>
<p>HTTPS连接的建立过程: 使用非对称加密来交换对称加密的密钥</p>
<p><img src="/images/HTTPs的建立过程.png" alt="img"></p>
<h2 id="生成证书"><a href="#生成证书" class="headerlink" title="生成证书"></a>生成证书</h2><ul>
<li>生成服务端证书</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 生成私钥</span><br><span class="line">openssl genrsa -out server.key 2048</span><br><span class="line"><span class="meta">#</span> 生成证书</span><br><span class="line">openssl req -new -x509 -key server.key -out server.pem -days 3650</span><br></pre></td></tr></table></figure>
<p>或者直接使用go内置工具</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go run $GOROOT/src/crypto/tls/generate_cert.go --host localhost</span><br></pre></td></tr></table></figure>
<ul>
<li>生成客户端证书</li>
</ul>
<p>并不是必须的<br>但在某些需要验证客户端身份的场景下，服务器需要客户端提供证书</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 生成私钥</span><br><span class="line">openssl genrsa -out client.key 2048</span><br><span class="line"><span class="meta">#</span> 生成证书</span><br><span class="line">openssl req -new -x509 -key client.key -out client.pem -days 3650</span><br></pre></td></tr></table></figure>
<h2 id="证书的使用"><a href="#证书的使用" class="headerlink" title="证书的使用"></a>证书的使用</h2><p>golang的<code>crypto/tls</code>实现了TLS1.2的功能，<code>crypto/x509</code>实现了证书管理的功能</p>
<ul>
<li>TCP服务器</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    cert, err := tls.LoadX509KeyPair(<span class="string">"server.pem"</span>, <span class="string">"server.key"</span>) <span class="comment">// 获取服务端证书</span></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Println(err)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    certBytes, err := ioutil.ReadFile(<span class="string">"client.pem"</span>) <span class="comment">// 读取客户端证书</span></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">"Unable to read cert.pem"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    clientCertPool := x509.NewCertPool()</span><br><span class="line">    ok := clientCertPool.AppendCertsFromPEM(certBytes)</span><br><span class="line">    <span class="keyword">if</span> !ok &#123;</span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">"failed to parse root certificate"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    config := &amp;tls.Config&#123;</span><br><span class="line">        Certificates: []tls.Certificate&#123;cert&#125;,</span><br><span class="line">        ClientAuth:   tls.RequireAndVerifyClientCert, <span class="comment">// 设置需要对客户端身份进行认证</span></span><br><span class="line">        ClientCAs:    clientCertPool, <span class="comment">// 添加客户端证书池</span></span><br><span class="line">    &#125;</span><br><span class="line">    config := &amp;tls.Config&#123;Certificates: []tls.Certificate&#123;cert&#125;&#125; <span class="comment">// 创建tls配置</span></span><br><span class="line">    ln, err := tls.Listen(<span class="string">"tcp"</span>, <span class="string">":443"</span>, config) <span class="comment">// 开启监听</span></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Println(err)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> ln.Close()</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        conn, err := ln.Accept() <span class="comment">// 建立连接</span></span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            log.Println(err)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">go</span> handleConn(conn) <span class="comment">// 处理请求</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handleConn</span><span class="params">(conn net.Conn)</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> conn.Close()</span><br><span class="line">    r := bufio.NewReader(conn)</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        msg, err := r.ReadString(<span class="string">'\n'</span>)</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            log.Println(err)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        log.Println(msg)</span><br><span class="line">        n, err := conn.Write([]<span class="keyword">byte</span>(<span class="string">"world\n"</span>))</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            log.Println(n, err)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>TCP客户端</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    cert, err := tls.LoadX509KeyPair(<span class="string">"client.pem"</span>, <span class="string">"client.key"</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Println(err)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    certBytes, err := ioutil.ReadFile(<span class="string">"client.pem"</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">"Unable to read cert.pem"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    clientCertPool := x509.NewCertPool()</span><br><span class="line">    ok := clientCertPool.AppendCertsFromPEM(certBytes)</span><br><span class="line">    <span class="keyword">if</span> !ok &#123;</span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">"failed to parse root certificate"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    conf := &amp;tls.Config&#123;</span><br><span class="line">        RootCAs:            clientCertPool,</span><br><span class="line">        Certificates:       []tls.Certificate&#123;cert&#125;, <span class="comment">// 在tls配置中添加客户端证书信息</span></span><br><span class="line">        InsecureSkipVerify: <span class="literal">true</span>, <span class="comment">// 设置为true，则不会校验服务器证书以及证书中的主机名和服务器主机名是否一致</span></span><br><span class="line">    &#125;</span><br><span class="line">    conn, err := tls.Dial(<span class="string">"tcp"</span>, <span class="string">"127.0.0.1:443"</span>, conf) <span class="comment">// 建立连接</span></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Println(err)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> conn.Close()</span><br><span class="line">    n, err := conn.Write([]<span class="keyword">byte</span>(<span class="string">"hello\n"</span>)) <span class="comment">// 写数据</span></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Println(n, err)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    buf := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">100</span>)</span><br><span class="line">    n, err = conn.Read(buf) <span class="comment">// 读数据</span></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Println(n, err)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    log.Println(<span class="keyword">string</span>(buf[:n]))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>HTTPs服务器</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    http.HandleFunc(<span class="string">"/hello"</span>, helloServerfunc)</span><br><span class="line">    server := &amp;http.Server&#123;</span><br><span class="line">        Addr: <span class="string">":443"</span>,</span><br><span class="line">        TLSConfig: &amp;tls.Config&#123;</span><br><span class="line">            ClientAuth: tls.RequestClientCert, <span class="comment">// 配置需要对客户端证书进行验证</span></span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">    err := server.ListenAndServeTLS(<span class="string">"cert/server.pem"</span>, <span class="string">"cert/server.key"</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatal(err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">helloServerfunc</span><span class="params">(rw http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">    rw.Header().Set(<span class="string">"Content-Type"</span>, <span class="string">"text/plain"</span>)</span><br><span class="line">    rw.Write([]<span class="keyword">byte</span>(<span class="string">"This is an example server.\n"</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在浏览器中输入<code>https://localhost/hello</code>即可访问</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/15/Golang-container/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yihang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yihang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/15/Golang-container/" itemprop="url">Golang-container</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-15T17:35:52+08:00">
                2019-01-15
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程技术/" itemprop="url" rel="index">
                    <span itemprop="name">编程技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/15/Golang-container/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/01/15/Golang-container/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="container-heap"><a href="#container-heap" class="headerlink" title="container/heap"></a>container/heap</h2><p>实现了堆数据结构: <a href="https://gravity-xin.github.io/2018/11/12/Heap/" target="_blank" rel="noopener">heap</a></p>
<p>提供了<code>heap.Interface</code>接口，同时提供了<code>Init、Push、Pop、Remove、Fix</code>方法对堆对象进行操作</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Interface 堆对象需要实现的接口</span></span><br><span class="line"><span class="keyword">type</span> Interface <span class="keyword">interface</span> &#123;</span><br><span class="line">    sort.Interface <span class="comment">// 排序接口</span></span><br><span class="line">    Push(x <span class="keyword">interface</span>&#123;&#125;) <span class="comment">// 向堆中加入元素，作为第Len()个元素</span></span><br><span class="line">    Pop() <span class="keyword">interface</span>&#123;&#125;   <span class="comment">// 从堆中删除元素，并返回Len()-1个元素</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Init 对提供的满足heap.Interface接口的对象进行建立最小堆的操作</span></span><br><span class="line"><span class="comment">// 时间复杂度为O(h.Len())</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Init</span><span class="params">(h Interface)</span></span> &#123;</span><br><span class="line">    n := h.Len()</span><br><span class="line">    <span class="keyword">for</span> i := n/<span class="number">2</span> - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i-- &#123;</span><br><span class="line">        down(h, i, n) <span class="comment">// 对堆中的元素下溯，调整堆</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Push 向堆底中增加元素，并通过上溯调整堆</span></span><br><span class="line"><span class="comment">// 时间复杂度O(log(h.Len()))</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Push</span><span class="params">(h Interface, x <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">    h.Push(x)</span><br><span class="line">    up(h, h.Len()<span class="number">-1</span>) <span class="comment">// 对堆中元素进行上溯，调整堆</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Pop 从堆顶删除元素，将堆尾元素放入堆顶，并通过下溯调整堆</span></span><br><span class="line"><span class="comment">// 时间复杂度为时间复杂度O(log(h.Len()))</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Pop</span><span class="params">(h Interface)</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">    n := h.Len() - <span class="number">1</span></span><br><span class="line">    h.Swap(<span class="number">0</span>, n) <span class="comment">// 将堆尾部元素放入堆顶</span></span><br><span class="line">    down(h, <span class="number">0</span>, n) <span class="comment">// 对堆中元素下溯吗，调整堆</span></span><br><span class="line">    <span class="keyword">return</span> h.Pop()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Remove 从堆中任意位置(数组下标)删除元素</span></span><br><span class="line"><span class="comment">// 时间复杂度为时间复杂度O(log(h.Len()))</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Remove</span><span class="params">(h Interface, i <span class="keyword">int</span>)</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">    n := h.Len() - <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> n != i &#123;</span><br><span class="line">        h.Swap(i, n)</span><br><span class="line">        <span class="keyword">if</span> !down(h, i, n) &#123;</span><br><span class="line">            up(h, i)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> h.Pop()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Fix 当位于i的位置的值发生变化后，调整堆</span></span><br><span class="line"><span class="comment">// 时间复杂度为时间复杂度O(log(h.Len()))</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Fix</span><span class="params">(h Interface, i <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> !down(h, i, h.Len()) &#123;</span><br><span class="line">        up(h, i)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因此，我们只需要实现heap.Interface接口，便可以通过heap包提供的方法对堆进行各种操作</p>
<p>基于heap实现优先级队列</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// Item 堆中的元素</span></span><br><span class="line"><span class="keyword">type</span> Item <span class="keyword">struct</span> &#123;</span><br><span class="line">    value    <span class="keyword">string</span> <span class="comment">// 元素值</span></span><br><span class="line">    priority <span class="keyword">int</span>    <span class="comment">// 元素的优先级</span></span><br><span class="line">    index    <span class="keyword">int</span>    <span class="comment">// 元素在堆中的索引(数组下标)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PriorityQueue 实现了heap.Interface的堆对象，本质上是一个数组</span></span><br><span class="line"><span class="keyword">type</span> PriorityQueue []*Item</span><br><span class="line"></span><br><span class="line"><span class="comment">// Len 返回PriorityQueue内置数组的长度</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(pq PriorityQueue)</span> <span class="title">Len</span><span class="params">()</span> <span class="title">int</span></span> &#123; <span class="keyword">return</span> <span class="built_in">len</span>(pq) &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Less 返回PriorityQueue中元素优先级的比较结果</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(pq PriorityQueue)</span> <span class="title">Less</span><span class="params">(i, j <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> pq[i].priority &gt; pq[j].priority <span class="comment">// 最大堆</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Swap 对PriorityQueue中的任意两个元素进行替换</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(pq PriorityQueue)</span> <span class="title">Swap</span><span class="params">(i, j <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    pq[i], pq[j] = pq[j], pq[i]</span><br><span class="line">    pq[i].index = i <span class="comment">// 更新元素索引</span></span><br><span class="line">    pq[j].index = j</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Push 向PriorityQueue添加元素，放入数组末尾</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(pq *PriorityQueue)</span> <span class="title">Push</span><span class="params">(x <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">    n := <span class="built_in">len</span>(*pq)</span><br><span class="line">    item := x.(*Item)</span><br><span class="line">    item.index = n</span><br><span class="line">    *pq = <span class="built_in">append</span>(*pq, item)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Pop 从PriorityQueue删除元素，删除数组尾部元素</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(pq *PriorityQueue)</span> <span class="title">Pop</span><span class="params">()</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">    old := *pq</span><br><span class="line">    n := <span class="built_in">len</span>(old)</span><br><span class="line">    item := old[n<span class="number">-1</span>]</span><br><span class="line">    item.index = <span class="number">-1</span></span><br><span class="line">    *pq = old[<span class="number">0</span> : n<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">return</span> item</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过heap.Fix方法处理堆中元素优先级变化的情况</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(pq *PriorityQueue)</span> <span class="title">update</span><span class="params">(item *Item, value <span class="keyword">string</span>, priority <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    item.value = value</span><br><span class="line">    item.priority = priority</span><br><span class="line">    heap.Fix(pq, item.index)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="container-list"><a href="#container-list" class="headerlink" title="container/list"></a>container/list</h2><p>实现了双向链表的数据结构</p>
<p>提供了<code>list.New()</code>方法来创建双向链表，同时链表还提供了<code>Init、Back、Front、InsertAfter、InsertFront、Len</code>等链表操作方法</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Element 双向链表中的元素</span></span><br><span class="line"><span class="keyword">type</span> Element <span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="comment">// 当前元素的前一个和后一个元素 next.Front()=prev.Back()=e</span></span><br><span class="line">    <span class="comment">// 实际是一个环</span></span><br><span class="line">    next, prev *Element</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当前元素所属的链表对象</span></span><br><span class="line">    list *List</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当前元素存储的实际值</span></span><br><span class="line">    Value <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Next 返回元素在链表中的下一个元素或者返回nil</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e *Element)</span> <span class="title">Next</span><span class="params">()</span> *<span class="title">Element</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> p := e.next; e.list != <span class="literal">nil</span> &amp;&amp; p != &amp;e.list.root &#123;</span><br><span class="line">        <span class="keyword">return</span> p</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Prev 返回元素在链表中的前一个元素或者返回nil</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e *Element)</span> <span class="title">Prev</span><span class="params">()</span> *<span class="title">Element</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> p := e.prev; e.list != <span class="literal">nil</span> &amp;&amp; p != &amp;e.list.root &#123;</span><br><span class="line">        <span class="keyword">return</span> p</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// List 双向链表</span></span><br><span class="line"><span class="keyword">type</span> List <span class="keyword">struct</span> &#123;</span><br><span class="line">    root Element <span class="comment">// root元素，作为哨兵 root.prev链表尾部元素 root.next链表头部元素</span></span><br><span class="line">    <span class="built_in">len</span>  <span class="keyword">int</span>     <span class="comment">// 链表长度，不包含root元素</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Init 初始化或者清空链表</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">Init</span><span class="params">()</span> *<span class="title">List</span></span> &#123;</span><br><span class="line">    l.root.next = &amp;l.root</span><br><span class="line">    l.root.prev = &amp;l.root</span><br><span class="line">    l.<span class="built_in">len</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> l</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// New 返回一个已初始化的链表对象</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">New</span><span class="params">()</span> *<span class="title">List</span></span> &#123; <span class="keyword">return</span> <span class="built_in">new</span>(List).Init() &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Len 返回链表的长度</span></span><br><span class="line"><span class="comment">// 时间复杂度是O(1)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">Len</span><span class="params">()</span> <span class="title">int</span></span> &#123; <span class="keyword">return</span> l.<span class="built_in">len</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Front 返回链表的头部元素，如果链表为空则返回nil</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">Front</span><span class="params">()</span> *<span class="title">Element</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> l.<span class="built_in">len</span> == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> l.root.next</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Back 返回链表的尾部元素，如果链表为空则返回nil</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">Back</span><span class="params">()</span> *<span class="title">Element</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> l.<span class="built_in">len</span> == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> l.root.prev</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Remove 从链表中删除元素e，返回元素e中的值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">Remove</span><span class="params">(e *Element)</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">    <span class="keyword">if</span> e.list == l &#123;</span><br><span class="line">        l.remove(e)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> e.Value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PushFront 在链表头部插入值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">PushFront</span><span class="params">(v <span class="keyword">interface</span>&#123;&#125;)</span> *<span class="title">Element</span></span> &#123;</span><br><span class="line">    l.lazyInit()</span><br><span class="line">    <span class="keyword">return</span> l.insertValue(v, &amp;l.root)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PushBack 在链表尾部插入值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">PushBack</span><span class="params">(v <span class="keyword">interface</span>&#123;&#125;)</span> *<span class="title">Element</span></span> &#123;</span><br><span class="line">    l.lazyInit()</span><br><span class="line">    <span class="keyword">return</span> l.insertValue(v, l.root.prev)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// InsertBefore 在元素mark之前插入值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">InsertBefore</span><span class="params">(v <span class="keyword">interface</span>&#123;&#125;, mark *Element)</span> *<span class="title">Element</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> mark.list != l &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> l.insertValue(v, mark.prev)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// InsertAfter 在元素mark之后插入值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">InsertAfter</span><span class="params">(v <span class="keyword">interface</span>&#123;&#125;, mark *Element)</span> *<span class="title">Element</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> mark.list != l &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> l.insertValue(v, mark)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MoveToFront 将链表中的某个元素插入到链表头部</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">MoveToFront</span><span class="params">(e *Element)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> e.list != l || l.root.next == e &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    l.insert(l.remove(e), &amp;l.root)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MoveToBack 将链表中的某个元素插入到链表尾部</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">MoveToBack</span><span class="params">(e *Element)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> e.list != l || l.root.prev == e &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// see comment in List.Remove about initialization of l</span></span><br><span class="line">    l.insert(l.remove(e), l.root.prev)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MoveBefore 将链表中的元素插入到元素mark之前</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">MoveBefore</span><span class="params">(e, mark *Element)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> e.list != l || e == mark || mark.list != l &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    l.insert(l.remove(e), mark.prev)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// MoveAfter 将链表中的元素插入到元素mark之后</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">MoveAfter</span><span class="params">(e, mark *Element)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> e.list != l || e == mark || mark.list != l &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    l.insert(l.remove(e), mark)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PushBackList 将另一个链表中的元素依次插入到当前链表的尾部</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">PushBackList</span><span class="params">(other *List)</span></span> &#123;</span><br><span class="line">    l.lazyInit()</span><br><span class="line">    <span class="keyword">for</span> i, e := other.Len(), other.Front(); i &gt; <span class="number">0</span>; i, e = i<span class="number">-1</span>, e.Next() &#123; <span class="comment">// 对链表进行遍历</span></span><br><span class="line">        l.insertValue(e.Value, l.root.prev)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PushFrontList 将另一个链表中的元素依次插入到当前链表的头部</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">PushFrontList</span><span class="params">(other *List)</span></span> &#123;</span><br><span class="line">    l.lazyInit()</span><br><span class="line">    <span class="keyword">for</span> i, e := other.Len(), other.Back(); i &gt; <span class="number">0</span>; i, e = i<span class="number">-1</span>, e.Prev() &#123;</span><br><span class="line">        l.insertValue(e.Value, &amp;l.root)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="container-ring"><a href="#container-ring" class="headerlink" title="container/ring"></a>container/ring</h2><p>实现了环形链表的数据结构</p>
<p>提供了<code>ring.New()</code>来创建环形链表，同时链表还提供了<code>Next、Prev、Move</code>等方法对链表进行操作</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Ring 环形链表元素，同时也是环形链表对象</span></span><br><span class="line"><span class="comment">// 环形链表没有头部或尾部元素，可以从环中任一个元素开始对整个环进行遍历</span></span><br><span class="line"><span class="keyword">type</span> Ring <span class="keyword">struct</span> &#123;</span><br><span class="line">    next, prev *Ring</span><br><span class="line">    Value      <span class="keyword">interface</span>&#123;&#125; <span class="comment">// 元素的具体值</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Next 获取环中当前元素的下一个元素</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Ring)</span> <span class="title">Next</span><span class="params">()</span> *<span class="title">Ring</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> r.next == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> r.init()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> r.next</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Prev 获取环中当前元素的前一个元素</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Ring)</span> <span class="title">Prev</span><span class="params">()</span> *<span class="title">Ring</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> r.next == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> r.init()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> r.prev</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Move 返回环形链表中后面 (n &gt; 0) 或者前面 (n &lt; 0) 第 n % r.Len() 个元素</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Ring)</span> <span class="title">Move</span><span class="params">(n <span class="keyword">int</span>)</span> *<span class="title">Ring</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> r.next == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> r.init()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">switch</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> n &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">for</span> ; n &lt; <span class="number">0</span>; n++ &#123;</span><br><span class="line">            r = r.prev</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">case</span> n &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">for</span> ; n &gt; <span class="number">0</span>; n-- &#123;</span><br><span class="line">            r = r.next</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// New 创建包含n个元素的环形链表</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">New</span><span class="params">(n <span class="keyword">int</span>)</span> *<span class="title">Ring</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> n &lt;= <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    r := <span class="built_in">new</span>(Ring)</span><br><span class="line">    p := r</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt; n; i++ &#123;</span><br><span class="line">        p.next = &amp;Ring&#123;prev: p&#125;</span><br><span class="line">        p = p.next</span><br><span class="line">    &#125;</span><br><span class="line">    p.next = r <span class="comment">// 首尾相连</span></span><br><span class="line">    r.prev = p</span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Link 将环形链表r和s相连接</span></span><br><span class="line"><span class="comment">// 如果r和s为同一个环形链表，则删除r和s中之间的元素，并返回被删除的元素构成的子环形链表</span></span><br><span class="line"><span class="comment">// 如果r和s不为同一个环形链表，则创建一个新的环形链表使得 r.Next() = s</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Ring)</span> <span class="title">Link</span><span class="params">(s *Ring)</span> *<span class="title">Ring</span></span> &#123;</span><br><span class="line">    n := r.Next()</span><br><span class="line">    <span class="keyword">if</span> s != <span class="literal">nil</span> &#123;</span><br><span class="line">        p := s.Prev()</span><br><span class="line">        <span class="comment">// Note: Cannot use multiple assignment because</span></span><br><span class="line">        <span class="comment">// evaluation order of LHS is not specified.</span></span><br><span class="line">        r.next = s</span><br><span class="line">        s.prev = r</span><br><span class="line">        n.prev = p</span><br><span class="line">        p.next = n</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> n</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Unlink 删除环形链表中 n % r.Len() 个元素,从r.Next()开始，返回的是被删除的环形链表</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Ring)</span> <span class="title">Unlink</span><span class="params">(n <span class="keyword">int</span>)</span> *<span class="title">Ring</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> n &lt;= <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> r.Link(r.Move(n + <span class="number">1</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Len 返回环形链表的长度</span></span><br><span class="line"><span class="comment">// 时间复杂度o(n)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Ring)</span> <span class="title">Len</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    n := <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> r != <span class="literal">nil</span> &#123;</span><br><span class="line">        n = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> p := r.Next(); p != r; p = p.next &#123;</span><br><span class="line">            n++</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> n</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do 向前遍历环形链表的元素，并元素值执行f函数操作</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Ring)</span> <span class="title">Do</span><span class="params">(f <span class="keyword">func</span>(<span class="keyword">interface</span>&#123;&#125;)</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> r != <span class="literal">nil</span> &#123;</span><br><span class="line">        f(r.Value)</span><br><span class="line">        <span class="keyword">for</span> p := r.Next(); p != r; p = p.next &#123;</span><br><span class="line">            f(p.Value)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Yihang</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">89</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">162</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Yihang</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"comment"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  


















  





  

  

  

  
  

  

  

  

</body>
</html>
